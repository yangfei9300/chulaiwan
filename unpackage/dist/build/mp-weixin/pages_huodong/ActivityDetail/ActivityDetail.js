(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_huodong/ActivityDetail/ActivityDetail"],{"0e3d":function(t,e,o){"use strict";(function(t,n){var i=o("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;i(o("4ed4"));var a={data:function(){return{img1:"https://ta.imjiayi.com/upload/upload/luomiao.png",showuquanAlert:!1,isPeoAlert:!1,baseurl:getApp().globalData.baseurl,token:getApp().globalData.token,lat:getApp().globalData.lat,lng:getApp().globalData.lng,act_no:"",distance:0,list:[],swiperList:[],list111:[],show:!1,show1:!1,lineshow:!1,spliceShow:!1,pay:!1,Detail:"",openid:"",nightMode:!1,showApp:!1,tokenValue:null,UserInfo:{},ActTicketList:[],selPiaoIndex:0}},onLoad:function(e){var o=this;console.log(e.act_no),this.act_no=e.act_no,t.login({success:function(t){console.log(t),o.code=t.code,o.getOpenid(o.code)}})},onShow:function(){var e=this,o=t.getStorageSync("token");o&&(this.tokenValue=t.getStorageSync("token"),this.token=t.getStorageSync("token"),this.getUserInfo()),setTimeout((function(t){e.showpagee()}),600),this.getDetail(),this.getYejian()},onShareTimeline:function(){return{title:this.list.title,path:"/pages_huodong/ActivityDetail/ActivityDetail?act_no="+this.list.act_no,imageUrl:this.list.cover}},mounted:function(){this.getDetail(),this.getlist111(),this.setlat()},onPullDownRefresh:function(){this.getDetail(),this.getYejian(),t.stopPullDownRefresh()},methods:{aaaa:function(){},preventTouchMove:function(){},spaceClick:function(t){this.selPiaoIndex=t},getSpaces:function(){var e=this,o=this.baseurl+"/api/act/getActTicket";t.request({url:o,method:"POST",data:{act_no:this.list.act_no,city:t.getStorageSync("citySel")},header:{xcx:1,token:this.token},success:function(t){e.ActTicketList=t.data.data;for(var o=0;o<e.ActTicketList.length;o++)e.ActTicketList[o].isshow=!1},fail:function(){},complete:function(){}})},isPeoAlertClick:function(){this.isPeoAlert=!this.isPeoAlert},getUserInfo:function(){var e=this,o=this.baseurl+"/api/user/getUserInfo",n=t.getStorageSync("token");n||(o=this.baseurl+"/api/IosVisitor/getUserInfo");var i=t.getStorageSync("uuid");t.request({url:o,method:"POST",data:{uuid:i},header:{xcx:1,token:this.token},success:function(o){console.log("个人信息",o),e.UserInfo=o.data.data,t.setStorageSync("userInfo",e.UserInfo)},fail:function(){},complete:function(){}})},handleAgree:function(e){console.log("handleAgree",e),this.showuquanAlert=!1;var o=t.getStorageSync("lat");o?this.getWeizhi():this.alertGps()},showuquanAlertClick:function(){this.showuquanAlert=!this.showuquanAlert},toyinsi:function(){n.openPrivacyContract({success:function(){},fail:function(){},complete:function(){}})},showpagee:function(){var e=this;n.getPrivacySetting({success:function(o){if(console.log("是否需要授权：",o.needAuthorization,"隐私协议的名称为：",o.privacyContractName),o.needAuthorization)e.showuquanAlert=o.needAuthorization;else{var n=t.getStorageSync("lat");n?e.getWeizhi():e.alertGps()}},fail:function(){},complete:function(){}})},alertGps:function(){var e=this;n.getSetting({success:function(o){console.log("当前设置",o.authSetting),console.log("当前设置",JSON.stringify(o));var n=JSON.stringify(o);n.indexOf('"scope.userFuzzyLocation":true')>=0?(console.log("直接获取位置"),e.getWeizhi()):(console.log("需要授权获取位置"),t.showModal({title:"授权",content:"需要获取您的位置信息，",success:function(t){t.confirm?e.getWeizhi():t.cancel&&console.log("用户点击取消")}}))}})},getWeizhi:function(){var e=this;t.getFuzzyLocation({type:"wgs84",success:function(o){var n=o.latitude,i=o.longitude;console.log("微信鼎和",o),t.setStorageSync("lat",n),t.setStorageSync("lng",i),getApp().globalData.lat=n,getApp().globalData.lng=i,e.lat=n,e.lng=i;var a=e.space(e.lat,e.lng,e.list.lat,e.list.lng).toFixed(2);e.distance=a,e.getDetail()},fail:function(t){console.log("定位失败",t)},complete:function(t){console.log("结果",t)}})},showimgsiper:function(e){t.previewImage({urls:this.swiperList,current:e,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})},hideview:function(){},showLoadApp:function(){this.showApp=!this.showApp},getYejian:function(){var t=this;n.getSystemInfo({success:function(e){var o="dark"===e.theme;t.nightMode=o,console.log("夜间模式状态:",o),console.log("夜间模式状态:",t.nightMode,e)}})},getOpenid:function(e){var o=this;t.request({url:this.baseurl+"/api/login/getOpenid",method:"POST",header:{xcx:1,token:this.token},data:{code:e,city:t.getStorageSync("citySel")},success:function(t){console.log("openid",t),o.openid=t.data.openid},fail:function(){},complete:function(){}})},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:this.list.title,path:"/pages_huodong/ActivityDetail/ActivityDetail?act_no="+this.act_no,imageUrl:this.list.cover}},acsf:function(t){this.lineshow=!this.lineshow},getlist111:function(){var e=this,o="/api/act/actList";this.tokenValue||(o="/api/IosVisitor/actList"),t.request({url:this.baseurl+o,method:"POST",header:{xcx:1,token:this.token},data:{cate_id:this.current,sort:2,lat:this.lat,lng:this.lng,page:1,num:4,city:t.getStorageSync("citySel")},success:function(t){console.log("活动列表",t),e.list111=t.data.data},fail:function(){},complete:function(){}})},getDetail:function(){var e=this,o="/api/act/actInfo";this.tokenValue||(o="/api/IosVisitor/actInfo"),t.request({url:this.baseurl+o,method:"POST",header:{xcx:1,token:this.token},data:{act_no:this.act_no,city:t.getStorageSync("citySel")},success:function(o){if(console.log("阿萨德科技",o),1001==o.data.code)t.showToast({title:"请先登录",icon:"none"}),setTimeout((function(e){t.navigateTo({url:"/pages/Login/Login"})}),1e3);else if(1==o.data.code){console.log("活动详情",o),e.list=o.data.data,e.getSpaces();for(var n=0;n<e.list.site.length;n++){var i=e.list.site[n];0!=i.lat&&i.lat?i.juli=e.space(e.lat,e.lng,i.lat,i.lng).toFixed(2)+"km":i.juli="未知",e.list.site[n]=i}e.list.zong=o.data.data.site.length,t.setNavigationBarTitle({title:e.list.title})}else setTimeout((function(e){t.showToast({title:o.data.info,icon:"none"}),t.reLaunch({url:"/pages/index/index"})}),1e3);e.swiperList=o.data.data.content_img;var a=e.space(e.lat,e.lng,e.list.lat,e.list.lng).toFixed(2)+"km";e.distance=a},fail:function(){},complete:function(){}})},gopay:function(){var e=this;if(this.openid){if(this.selPiaoIndex<0)return t.showToast({title:"请先选择套餐",mask:!0,icon:"none"}),!1;console.log("支付1"),t.request({url:e.baseurl+"/api/actDo/prepay_new",method:"POST",header:{xcx:1,token:e.token},data:{act_no:e.act_no,pay_type:3,remark:e.Detail,openid:e.openid,ticket_id:this.ActTicketList[this.selPiaoIndex].id,phone:this.UserInfo.phone,city:t.getStorageSync("citySel")},success:function(o){1==o.data.code?t.requestPayment({provider:"wxpay",timeStamp:o.data.data.timeStamp,nonceStr:o.data.data.nonceStr,package:o.data.data.package,signType:o.data.data.signType,paySign:o.data.data.paySign,success:function(o){t.showToast({title:"支付成功",icon:"none",success:function(){e.getDetail(),e.pay=!e.pay}}),console.log("success:"+JSON.stringify(o))},fail:function(e){console.log(e),t.showToast({title:"支付失败",icon:"none"}),console.log("fail:"+JSON.stringify(e))},complete:function(t){console.log("支付API刻骨1",t)}}):t.showToast({title:o.data.info,icon:"none"})},fail:function(){},complete:function(t){console.log("支付接口刻骨1",t)}})}else t.showToast({title:"支付错误",mask:!0,icon:"none"})},ActiveDetail:function(e){t.navigateTo({url:"../../pages_huodong/ActivityDetail/ActivityDetail?act_no=".concat(e),success:function(t){},fail:function(){},complete:function(){}})},onPhone:function(e){t.makePhoneCall({phoneNumber:e+"",success:function(t){console.log(t)}})},openLocation:function(e,o,i,a){console.log("-1111---",e,o,i,a),n.openLocation({latitude:parseFloat(e+""),longitude:parseFloat(o+""),scale:18,name:this.list.add_name,address:this.list.add_detail,success:function(t){console.log("-1111---",t)},fail:function(e){console.log("导航失败",e),t.showToast({title:"导航失败",icon:"none"})},complete:function(t){console.log("complete2222",t)}})},space:function(t,e,o,n){var i=t*Math.PI/180,a=o*Math.PI/180,s=i-a,c=e*Math.PI/180-n*Math.PI/180,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(i)*Math.cos(a)*Math.pow(Math.sin(c/2),2)));return l*=6378.137,l=Math.round(1e4*l)/1e4,l},actJoin:function(){var e=this;if(!this.tokenValue)return t.showToast({title:"请先登录",icon:"none"}),setTimeout((function(e){t.navigateTo({url:"/pages/Login/Login"})}),1e3),!1;var o=t.getStorageSync("loginInfo");if(o&&0==o.status)return t.showToast({title:"请先完善信息",icon:"none"}),setTimeout((function(e){t.navigateTo({url:"/pages_yindao/yindao1/yindao1"})}),1e3),!1;1==this.list.is_prepay?this.pay=!this.pay:t.request({url:this.baseurl+"/api/actDo/actJoin",method:"POST",header:{xcx:1,token:this.token},data:{act_no:this.act_no,lat:this.lat,lng:this.lng,city:t.getStorageSync("citySel")},success:function(o){console.log(o),0==o.data.code?t.showToast({title:o.data.info,mask:!0,icon:"none"}):(t.showToast({title:o.data.info,mask:!0,icon:"none"}),e.getDetail())},fail:function(){},complete:function(){}})},Ready:function(){var e=this;t.request({url:this.baseurl+"/api/actGroup/actUserReady",method:"POST",header:{xcx:1,token:this.token},data:{act_no:this.act_no,city:t.getStorageSync("citySel")},success:function(o){console.log("准备",o),0==o.data.code?t.showToast({title:o.data.info,mask:!0,icon:"none"}):1==o.data.code&&(t.showToast({title:o.data.info,mask:!0,icon:"none"}),e.setlat(),t.request({url:e.baseurl+"/api/actGroup/actUserStart",method:"POST",header:{token:e.token},data:{act_no:e.act_no,city:t.getStorageSync("citySel")},success:function(o){console.log("立即出发",o),1==o.data.code?e.getDetail():t.showToast({title:o.data.info,mask:!0,icon:"none"})},fail:function(){},complete:function(){}}))},fail:function(){},complete:function(){}})},teamMember:function(e){var o=this;if(1==e);else if(2==e){var n=this;t.scanCode({onlyFromCamera:!0,success:function(e){console.log("扫码",e.result,n.baseurl),e.result&&t.request({url:n.baseurl+"/api/actGroup/actUserSign",method:"POST",header:{xcx:1,token:n.token},data:{act_no:e.result,city:t.getStorageSync("citySel")},success:function(e){console.log("扫码签到",e),0==e.data.code?t.showToast({title:e.data.info,mask:!0}):1==e.data.code&&(t.showToast({title:e.data.info,mask:!0}),n.show=!1,n.getDetail())},fail:function(){},complete:function(){}})}})}else if(3==e){var i=this;t.showModal({title:"退出队伍",content:"确认要退出队伍吗",success:function(e){e.confirm?t.request({url:i.baseurl+"/api/actGroup/actUserQuit",method:"POST",header:{xcx:1,token:i.token},data:{act_no:i.act_no,city:t.getStorageSync("citySel")},success:function(e){console.log("退出队伍",e),1==e.data.code?(t.showToast({title:e.data.info,mask:!0}),i.isPeoAlertClick(),i.getDetail(),setTimeout((function(){t.navigateBack({delta:1})}),1e3),i.show=!1):0==e.data.code&&t.showToast({title:e.data.info,mask:!0,icon:"error"})},fail:function(){},complete:function(){}}):e.cancel&&console.log("用户点击取消")}})}else if(4==e){var a=JSON.stringify(this.list);t.navigateTo({url:"../SginIn/SginIn?list="+a,success:function(t){},fail:function(){},complete:function(){}})}else 5==e?this.spliceShow?this.spliceShow=!1:this.spliceShow=!0:6==e?t.request({url:this.baseurl+"/api/actGroup/actCaptainReceive",method:"POST",header:{xcx:1,token:this.token},data:{act_no:this.act_no,city:t.getStorageSync("citySel")},success:function(e){console.log("提前收队",e),0==e.data.code?t.showToast({title:e.data.info,icon:"error",mask:!0}):1==e.data.code&&(t.showToast({title:e.data.info,icon:"success",mask:!0}),o.setlat(),o.getDetail())},fail:function(){},complete:function(){}}):7==e&&t.request({url:this.baseurl+"/api/actGroup/actCaptainDissolve",method:"POST",header:{xcx:1,token:this.token},data:{act_no:this.act_no,city:t.getStorageSync("citySel")},success:function(e){console.log("解散",e),0==e.data.code?t.showToast({title:e.data.info,icon:"error",mask:!0}):1==e.data.code&&(t.showToast({title:e.data.info,icon:"success",mask:!0}),setTimeout((function(){t.navigateBack({delta:1})}),1e3))},fail:function(){},complete:function(){}})},setlat:function(){t.request({url:this.baseurl+"/api/actGroup/upLocation",method:"POST",header:{xcx:1,token:this.token},data:{lat:this.lat,lng:this.lng,act_no:this.act_no,city:t.getStorageSync("citySel")},success:function(t){console.log("上报经纬度",t)},fail:function(){},complete:function(){}})},Onsplice:function(e,o){var n=this;0!=o&&t.request({url:this.baseurl+"/api/actGroup/actCaptainOutTeam",method:"POST",header:{xcx:1,token:this.token},data:{uuid:e,act_no:this.act_no,city:t.getStorageSync("citySel")},success:function(e){0==e.data.code?t.showToast({title:e.data.info,mask:!0,icon:"none"}):1==e.data.code&&(t.showToast({title:e.data.info,mask:!0,icon:"none"}),n.list.site.splice(o,1)),console.log(e)},fail:function(){},complete:function(){}})},Navmy:function(e){e&&t.navigateTo({url:"/pages_wode/PersonalCenter/PersonalCenter?uuid="+e,success:function(t){},fail:function(){},complete:function(){}})}}};e.default=a}).call(this,o("543d")["default"],o("bc2e")["default"])},"0fe7":function(t,e,o){"use strict";o.r(e);var n=o("0e3d"),i=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(a);e["default"]=i.a},"3e4c":function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.show1=!0},t.e1=function(e){t.lineshow=!0},t.e2=function(e){t.show=!1,t.show1=!1,t.pay=!1,t.lineshow=!1},t.e3=function(e){t.show=!1},t.e4=function(e){t.show1=!1})},i=[]},"6cbe":function(t,e,o){"use strict";(function(t,e){var n=o("4ea4");o("a1a6");n(o("66fd"));var i=n(o("973a"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(i.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"973a":function(t,e,o){"use strict";o.r(e);var n=o("3e4c"),i=o("0fe7");for(var a in i)["default"].indexOf(a)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(a);o("bb3f");var s=o("f0c5"),c=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"45b629d6",null,!1,n["a"],void 0);e["default"]=c.exports},bb3f:function(t,e,o){"use strict";var n=o("d34d"),i=o.n(n);i.a},d34d:function(t,e,o){}},[["6cbe","common/runtime","common/vendor"]]]);