(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_huodong/Detail/Detail"],{1950:function(t,o,e){"use strict";e.r(o);var n=e("ffe6"),i=e("656c");for(var s in i)["default"].indexOf(s)<0&&function(t){e.d(o,t,(function(){return i[t]}))}(s);e("94ab");var a=e("f0c5"),c=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,"51991e52",null,!1,n["a"],void 0);o["default"]=c.exports},"656c":function(t,o,e){"use strict";e.r(o);var n=e("9a67"),i=e.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){e.d(o,t,(function(){return n[t]}))}(s);o["default"]=i.a},"94ab":function(t,o,e){"use strict";var n=e("aecc"),i=e.n(n);i.a},"9a67":function(t,o,e){"use strict";(function(t,e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n={data:function(){return{showuquanAlert:!1,baseurl:getApp().globalData.baseurl,token:getApp().globalData.token,shop_no:"",sign_num:Number,comlist:[],comments:Number,lat:getApp().globalData.lat,lng:getApp().globalData.lng,list:[],swiperlist:[],zhutuilist:[],shopList:[]}},onLoad:function(t){var o=this;this.getIsToken(),this.shop_no=t.shop_no,setTimeout((function(t){o.getShopList()}),100)},onShow:function(){var t=this;setTimeout((function(o){t.showpagee()}),600)},mounted:function(){},methods:{handleAgree:function(o){console.log("handleAgree",o),this.showuquanAlert=!1;var e=t.getStorageSync("lat");e?this.getWeizhi():this.alertGps()},showuquanAlertClick:function(){this.showuquanAlert=!this.showuquanAlert},toyinsi:function(){e.openPrivacyContract({success:function(){},fail:function(){},complete:function(){}})},showpagee:function(){var o=this;e.getPrivacySetting({success:function(e){if(console.log("是否需要授权：",e.needAuthorization,"隐私协议的名称为：",e.privacyContractName),e.needAuthorization)o.showuquanAlert=e.needAuthorization;else{var n=t.getStorageSync("lat");n?o.getWeizhi():o.alertGps()}},fail:function(){},complete:function(){}})},alertGps:function(){var o=this;e.getSetting({success:function(e){console.log("当前设置",e.authSetting),console.log("当前设置",JSON.stringify(e));var n=JSON.stringify(e);n.indexOf('"scope.userFuzzyLocation":true')>=0?(console.log("直接获取位置"),o.getWeizhi()):(console.log("需要授权获取位置"),t.showModal({title:"授权",content:"需要获取您的位置信息，",success:function(t){t.confirm?o.getWeizhi():t.cancel&&console.log("用户点击取消")}}))}})},getWeizhi:function(){var o=this;t.getFuzzyLocation({type:"wgs84",success:function(e){var n=e.latitude,i=e.longitude;console.log("微信鼎和",e),t.setStorageSync("lat",n),t.setStorageSync("lng",i),getApp().globalData.lat=n,getApp().globalData.lng=i,o.lat=n,o.lng=i,o.list.distance=o.space(o.lat,o.lng,o.list.lat,o.list.lng).toFixed(2)},fail:function(t){console.log("定位失败",t)},complete:function(t){console.log("结果",t)}})},getIsToken:function(){var o=this;t.request({url:this.baseurl+"/api/IosVisitor/checkToken",method:"POST",data:{token:this.token,city:t.getStorageSync("citySel")},header:{xcx:1,token:this.token},success:function(e){var n=e.data;0==n.code&&(getApp().globalData.token=null,o.token=null,t.removeStorageSync("token")),o.getDetail(),o.commentLength(),o.commentList(),o.zhutui()},fail:function(){},complete:function(){}})},toshopinfo:function(o){t.redirectTo({url:"/pages_huodong/Detail/Detail?shop_no="+o.shop_no})},getShopList:function(){var o=this,e=t.getStorageSync("token"),n=this.baseurl+"/api/shop/shopList";e||(n=this.baseurl+"/api/IosVisitor/shopList"),t.request({url:n,method:"POST",header:{xcx:1,token:this.token},data:{shop_no:this.shop_no,cate_id:this.list.cate_id,lat:this.lat,lng:this.lng,city:t.getStorageSync("citySel")},success:function(t){o.shopList=t.data.data;for(var e=0;e<o.shopList.length;e++){var n=o.space(o.lat,o.lng,o.shopList[e].lat,o.shopList[e].lng).toFixed(2);console.log("距離",n),o.shopList[e].distance=n}},fail:function(){},complete:function(){}})},toFabu:function(){t.navigateTo({url:"/pages/Group/Group"})},showimg:function(o,e){t.previewImage({current:o,urls:e,longPressActions:{success:function(t){},fail:function(t){}}})},getDetail:function(){var o=this,e=t.getStorageSync("token"),n=this.baseurl+"/api/shop/shopInfo";e||(n=this.baseurl+"/api/IosVisitor/shopInfo"),t.request({url:n,method:"POST",header:{xcx:1,token:this.token},data:{shop_no:this.shop_no,lat:this.lat,lng:this.lng,city:t.getStorageSync("citySel")},success:function(e){t.setNavigationBarTitle({title:e.data.data.name}),console.log("商家详情",e),o.list=e.data.data,o.swiperlist=e.data.data.slider,o.sign_num=e.data.data.sign_num,o.list.distance=o.space(o.lat,o.lng,o.list.lat,o.list.lng).toFixed(2)},fail:function(){},complete:function(){}})},commentLength:function(){var o=this,e=t.getStorageSync("token"),n=this.baseurl+"/api/shop/shopCommentTotal";e||(n=this.baseurl+"/api/IosVisitor/shopCommentTotal"),t.request({url:n,method:"POST",header:{xcx:1,token:this.token},data:{shop_no:this.shop_no,city:t.getStorageSync("citySel")},success:function(t){console.log("评论总条数",t),o.comments=t.data.data},fail:function(){},complete:function(){}})},commentList:function(){var o=this,e=t.getStorageSync("token"),n=this.baseurl+"/api/shop/shopCommentList";e||(n=this.baseurl+"/api/IosVisitor/shopCommentList"),t.request({url:n,method:"POST",header:{xcx:1,token:this.token},data:{shop_no:this.shop_no,page:1,num:10,city:t.getStorageSync("citySel")},success:function(t){console.log("商家评论列表",t),o.comlist=t.data.data},fail:function(){},complete:function(){}})},zhutui:function(){var o=this,e=t.getStorageSync("token"),n=this.baseurl+"/api/shop/shopGoodsList";e||(n=this.baseurl+"/api/IosVisitor/shopGoodsList"),t.request({url:n,method:"POST",header:{xcx:1,token:this.token},data:{shop_no:this.shop_no,city:t.getStorageSync("citySel")},success:function(t){console.log("商家评论列表",t),o.zhutuilist=t.data.data},fail:function(){},complete:function(){}})},space:function(t,o,e,n){console.error(t,o,e,n);var i=t*Math.PI/180,s=e*Math.PI/180,a=i-s,c=o*Math.PI/180-n*Math.PI/180,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(i)*Math.cos(s)*Math.pow(Math.sin(c/2),2)));return l*=6378.137,l=Math.round(1e4*l)/1e4,l},onShareAppMessage:function(t){return console.log("/pages_huodong/Detail/Detail?shop_no="+this.shop_n,"分享参数"),"button"===t.from&&console.log(t.target),{title:this.list.name,path:"/pages_huodong/Detail/Detail?shop_no="+this.shop_no}},onPhone:function(o){t.makePhoneCall({phoneNumber:o+"",success:function(t){console.log(t)}})},openLocation:function(o,e,n,i){t.openLocation({latitude:parseFloat(o+""),longitude:parseFloat(e+""),address:this.list.address+this.list.detail_address,name:this.list.name,success:function(t){console.log("查看地图位置",t)},fail:function(o){console.log("导航失败",o),t.showToast({title:"导航失败",icon:"none"})},complete:function(t){console.log("导航打开地图结果",t)}})},previewImage:function(o){t.previewImage({urls:this.swiperlist,current:o,success:function(t){console.log(t)}})}}};o.default=n}).call(this,e("543d")["default"],e("bc2e")["default"])},aecc:function(t,o,e){},b560:function(t,o,e){"use strict";(function(t,o){var n=e("4ea4");e("a1a6");n(e("66fd"));var i=n(e("1950"));t.__webpack_require_UNI_MP_PLUGIN__=e,o(i.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},ffe6:function(t,o,e){"use strict";e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return s})),e.d(o,"a",(function(){return n}));var n={uniRate:function(){return e.e("uni_modules/uni-rate/components/uni-rate/uni-rate").then(e.bind(null,"4535"))}},i=function(){var t=this.$createElement,o=(this._self._c,this.swiperlist.length);this.$mp.data=Object.assign({},{$root:{g0:o}})},s=[]}},[["b560","common/runtime","common/vendor"]]]);