# aegis-web-sdk


Aegis æ˜¯è…¾è®¯äº‘ç›‘æ§å›¢é˜Ÿæä¾›çš„å‰ç«¯ç›‘æ§ SDKï¼Œæ¶µç›–äº†é”™è¯¯ç›‘æ§ï¼Œèµ„æºæµ‹é€Ÿï¼ˆimg, script, cssï¼‰ï¼Œæ¥å£æµ‹é€Ÿï¼Œé¡µé¢æ€§èƒ½ï¼ˆé¦–å±æ—¶é—´ï¼‰ã€‚æ— éœ€ä¾µå…¥ä»£ç ï¼Œåªéœ€å¼•å…¥ SDK å³å¯è‡ªåŠ¨å®Œæˆæ‰€æœ‰ç›‘æ§ä¸ŠæŠ¥ã€‚

åœ¨ä½¿ç”¨ aegis æ—¶æ— éœ€åœ¨ä¸šåŠ¡ä»£ç ä¸­æ‰“ç‚¹æˆ–è€…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œå¯ä»¥åšåˆ°ä¸ä¸šåŠ¡ä»£ç å……åˆ†è§£è€¦ã€‚aegis å°†ä¼šè‡ªåŠ¨ç›‘æ§å‰ç«¯é”™è¯¯ï¼Œåœ¨é”™è¯¯å‘ç”Ÿæ—¶ä¸ŠæŠ¥é”™è¯¯çš„å…·ä½“æƒ…å†µï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½é—®é¢˜ã€‚å½“æ‚¨å¼€å¯èµ„æºæµ‹é€Ÿæ—¶ï¼Œaegis å°†ä¼šè‡ªåŠ¨ç›‘å¬é¡µé¢èµ„æºåŠ è½½æƒ…å†µï¼ˆè€—è´¹æ—¶é•¿ã€æˆåŠŸç‡ç­‰ï¼‰ï¼Œå¹¶åœ¨ä¸å½±å“å‰ç«¯æ€§èƒ½çš„å‰æä¸‹æ”¶é›†å‰ç«¯çš„æ€§èƒ½æ•°æ®ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½æ€§èƒ½çŸ­æ¿ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

ä½¿ç”¨æœ¬ SDK éœ€è¦é…åˆä½¿ç”¨è…¾è®¯äº‘å‰ç«¯æ€§èƒ½ç›‘æ§ [RUM å¹³å°](https://console.cloud.tencent.com/rum)ã€‚

## Usage

1. å‰å¾€è…¾è®¯äº‘å‰ç«¯æ€§èƒ½ç›‘æ§ [RUM å¹³å°](https://console.cloud.tencent.com/rum)

2. ç”³è¯·é¡¹ç›®ï¼Œç”³è¯·å®Œæˆåå¾—åˆ°`ä¸ŠæŠ¥ id`ï¼Œid åœ¨ sdk åˆå§‹åŒ–çš„æ—¶å€™ä¼šä½¿ç”¨ã€‚

Aegis SDK åœ¨ä¸ŠæŠ¥æ‰€æœ‰æ•°æ®æ—¶éƒ½ä¼šå¸¦ä¸Š`ä¸ŠæŠ¥ id`ï¼Œåç«¯æœåŠ¡å°†æ ¹æ®`ä¸ŠæŠ¥ id`è¾¨åˆ«æ•°æ®æ¥è‡ªå“ªä¸€ä¸ªé¡¹ç›®ï¼Œå› æ­¤ï¼ŒAegis å»ºè®®ä¸ºæ¯ä¸€ä¸ªé¡¹ç›®éƒ½å•ç‹¬ç”³è¯·ä¸€ä¸ª idï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®ä¸‹æœ‰å¤šä¸ªé¡µé¢ï¼Œè¿˜å¯ä»¥ä¸ºæ¯ä¸€ä¸ªé¡µé¢éƒ½ç”³è¯·ä¸€ä¸ªé¡¹ç›® idï¼Œæ–¹ä¾¿å•ç‹¬æŸ¥çœ‹æ¯ä¸€ä¸ªé¡µé¢çš„ PVã€é”™è¯¯ç‡ã€è¯·æ±‚é”™è¯¯ç‡ç­‰æ•°æ®ã€‚

aegis-sdk é»˜è®¤ä½¿ç”¨ `https://aegis.qq.com` ä½œä¸ºä¸ŠæŠ¥åŸŸåï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä¿®æ”¹ hostUrl å‚æ•°ä½¿ç”¨ `https://rumt-zh.com` ä½œä¸ºä¸ŠæŠ¥åŸŸåã€‚å¦‚æœæ˜¯è…¾è®¯å†…ç½‘ç”¨æˆ·ï¼Œæœ‰ç‰¹æ®Šéœ€æ±‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `https://aegis-report.woa.com` ä½œä¸ºä¸ŠæŠ¥åŸŸåã€‚

## ä½¿ç”¨SDK

### å®‰è£… SDK

é’ˆå¯¹å„ç§æƒ…å†µï¼Œ SDK æä¾›äº†ä¸‰ç§å¼•å…¥æ–¹å¼ï¼Œé€‰æ‹©é€‚åˆä¸šåŠ¡ä¸­çš„ä¸€ç§å³å¯ã€‚æ— è®ºå“ªç§ä½¿ç”¨æ–¹æ³•ï¼Œè¯·åŠ¡å¿…ä¿è¯ sdk åœ¨ `<head></head>` å†…ï¼Œæœ€å…ˆå£°æ˜ã€‚è¿™æ ·èƒ½ä¿è¯æ‹¿åˆ°å„ç±»æ•°æ®ç›‘æ§ã€‚

1. cdn å¼•å…¥

èµ„æºåœ°å€å¦‚ä¸‹ï¼š

æœ€æ–°ç‰ˆæœ¬ï¼šhttps://cdn-go.cn/aegis/aegis-sdk/latest/aegis.min.js

ç‰¹å®šç‰ˆæœ¬(æ³¨æ„é“¾æ¥ä¸­çš„ç‰ˆæœ¬å·)ï¼šhttps://cdn-go.cn/aegis/aegis-sdk/{version}/aegis.min.js

> ç‰ˆæœ¬è¯´æ˜ï¼šä¸ºäº†ä¿è¯CDNçš„ç¨³å®šæ€§ï¼Œâ€œlatestâ€ ç‰ˆæœ¬å°†ä¼šæ¯”â€œnpmâ€ç‰ˆæœ¬ç¨æ»åä¸€äº›ï¼›

å°†ä¼šåœ¨ window ä¸ŠæŒ‚è½½ `Aegis` æ„é€ å‡½æ•°ã€‚

è¯¥ cdn ä½¿ç”¨ â€œh3-Q050â€ åè®®ï¼Œé»˜è®¤ cache-control ä¸º max-age=666ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ cache-controlï¼Œå¯ä»¥æ·»åŠ å‚æ•° max_ageï¼Œå¦‚

```html
<script src="https://tam.cdn-go.cn/aegis-sdk/latest/aegis.min.js?max_age=3600"></script>
```

2. npm å¼•å…¥

```sh
$ npm install aegis-web-sdk
```

2. å†…è”å¼•å…¥

å¦‚æœæƒ³è¦æŠŠ SDK ä»£ç ç›´æ¥å†…è”åˆ° html ä¸­çš„è¯ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥ copy ä»£ç çš„æ–¹å¼ï¼Œæˆ–è€…ä½¿ç”¨æ‚¨ç†Ÿæ‚‰æ‰“åŒ…å·¥å…·çš„å†…è”ä»£ç çš„å·¥å…·


**æ¨èä½¿ç”¨ CDN çš„æ–¹å¼ä½¿ç”¨ aegisï¼Œå¯ä»¥äº«ç”¨æ›´æ–°æ›´å…¨çš„åŠŸèƒ½ï¼Œæ›´åŠæ—¶ä¿®å¤ bugï¼Œå¹¶ä¸”ä½“éªŒæ— æ„Ÿå‡çº§çš„å¿«æ„Ÿã€‚**
æˆ‘ä»¬ä¹Ÿä¼šå°½å…¨åŠ›ä¿è¯ CDN ç‰ˆæœ¬çš„ç¨³å®šï¼Œè¯·æ‚¨æ–¹ä¾¿ä½¿ç”¨ã€‚

### SDK å®ä¾‹åŒ–

å¼•å…¥ SDK åï¼Œéœ€å®ä¾‹åŒ–:

```javascript
// å¦‚æœä½¿ç”¨ npm å¯ä»¥ç›´æ¥ import
import Aegis from 'aegis-web-sdk';

// å¦‚æœä½¿ç”¨ cdn çš„è¯ï¼ŒAegis ä¼šè‡ªåŠ¨ç»‘å®šåœ¨ window å¯¹è±¡ä¸Š
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx', // é¡¹ç›®ä¸ŠæŠ¥id
  uin: 'xxx', // ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼ˆå¯é€‰ï¼‰
  reportApiSpeed: true, // æ¥å£æµ‹é€Ÿ
  reportAssetSpeed: true, // é™æ€èµ„æºæµ‹é€Ÿ
  spa: true, // spa é¡µé¢éœ€è¦å¼€å¯ï¼Œé¡µé¢åˆ‡æ¢çš„æ—¶å€™ä¸ŠæŠ¥pv
});
```

::: warning æ³¨æ„ âš ï¸
ä¸ºäº†ä¸é—æ¼æ•°æ®ï¼Œé¡»å°½æ—©è¿›è¡Œåˆå§‹åŒ–ï¼›
åˆå§‹åŒ–ä¹‹åï¼Œå¯ä»¥æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹ä¸ŠæŠ¥æ¥å£æ˜¯å¦æ­£å¸¸ï¼Œnetwork ä¸­æœç´¢ä¸ŠæŠ¥åŸŸåï¼ˆé»˜è®¤ aegis.qq.comï¼‰æŸ¥çœ‹ä¸ŠæŠ¥æ•°æ®æƒ…å†µã€‚
å¦‚æœä¸ŠæŠ¥æ¥å£è¿”å› 403 å¯ä»¥æŸ¥çœ‹ [æŠ€æœ¯æ’æŸ¥ç›¸å…³é—®é¢˜](https://cloud.tencent.com/document/product/1464/58608)ã€‚
:::

::: tip å½“æ‚¨åšäº†ä»¥ä¸Šæ¥å…¥å·¥ä½œä¹‹åï¼Œæ‚¨å·²ç»å¼€å§‹äº«å— Aegis æä¾›çš„ä»¥ä¸‹åŠŸèƒ½ï¼š
1ã€é”™è¯¯ç›‘æ§ï¼šJSæ‰§è¡Œé”™è¯¯ã€Promiseé”™è¯¯ã€Ajaxè¯·æ±‚å¼‚å¸¸ã€èµ„æºåŠ è½½å¤±è´¥ã€è¿”å›ç å¼‚å¸¸ã€pvä¸ŠæŠ¥ã€ç™½åå•æ£€æµ‹ç­‰ï¼›  
2ã€æµ‹é€Ÿï¼šé¡µé¢æ€§èƒ½æµ‹é€Ÿã€æ¥å£æµ‹é€Ÿã€é™æ€èµ„æºæµ‹é€Ÿï¼›  
3ã€æ•°æ®ç»Ÿè®¡å’Œåˆ†æï¼šå¯åœ¨ [RUM å¹³å°](https://console.cloud.tencent.com/rum) ä¸ŠæŸ¥çœ‹å„ä¸ªç»´åº¦çš„æ•°æ®åˆ†æï¼›  
:::

## æ—¥å¿—

Aegis SDK ä¼šä¸»åŠ¨æ”¶é›†ç”¨æˆ·çš„ä¸€äº›æ€§èƒ½å’Œé”™è¯¯æ—¥å¿—ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°æ¥é…ç½®å“ªäº›æ—¥å¿—éœ€è¦ä¸ŠæŠ¥ï¼Œä»¥åŠä¸ŠæŠ¥çš„æ—¥å¿—å…·ä½“ä¿¡æ¯ã€‚

### æ—¥å¿—ç±»å‹

å…¨éƒ¨æ—¥å¿—ç±»å‹å¦‚ä¸‹ï¼š

```javascript
{ logType: 'custom', name: 'è‡ªå®šä¹‰æµ‹é€Ÿ' }
{ logType: 'event', name: 'è‡ªå®šä¹‰äº‹ä»¶' }
{ logType: 'log', name: 'æ—¥å¿—' }
{ logType: 'performance', name: 'é¡µé¢æµ‹é€Ÿ' }
{ logType: 'pv', name: 'é¡µé¢PV' }
{ logType: 'speed', name: 'æ¥å£å’Œé™æ€èµ„æºæµ‹é€Ÿ' }
{ logType: 'vitals', name: 'web vitals' }
```


### æ—¥å¿—ç­‰çº§

å…¨éƒ¨æ—¥å¿—ç­‰çº§å¦‚ä¸‹ï¼š

```javascript
  { level: 1, name: 'ç™½åå•æ—¥å¿—' },
  { level: 2, name: 'ä¸€èˆ¬æ—¥å¿—' },
  { level: 4, name: 'é”™è¯¯æ—¥å¿—' },
  { level: 8, name: 'Promise é”™è¯¯' },
  { level: 16, name: 'Ajax è¯·æ±‚å¼‚å¸¸' },
  { level: 32, name: 'JS åŠ è½½å¼‚å¸¸' },
  { level: 64, name: 'å›¾ç‰‡åŠ è½½å¼‚å¸¸' },
  { level: 128, name: 'css åŠ è½½å¼‚å¸¸' },
  { level: 256, name: 'console.error' },
  { level: 512, name: 'éŸ³è§†é¢‘èµ„æºå¼‚å¸¸' }
  { level: 1024, name: 'retcode å¼‚å¸¸' }
  { level: 2048, name: 'aegis report' }
  { level: 4096, name: 'PV' }
  { level: 8192, name: 'è‡ªå®šä¹‰äº‹ä»¶' }
  { level: 16384, name: 'å°ç¨‹åº é¡µé¢ä¸å­˜åœ¨' }
  { level: 32768, name: 'websocketé”™è¯¯' }
  { level: 65536, name: 'js bridgeé”™è¯¯' }
```
## aid

Aegis SDK ä¸ºæ¯ä¸ªç”¨æˆ·è®¾å¤‡åˆ†é…çš„å”¯ä¸€æ ‡è¯†ï¼Œä¼šå­˜å‚¨åœ¨æµè§ˆå™¨çš„ localStorage é‡Œé¢ï¼Œç”¨æ¥åŒºåˆ†ç”¨æˆ·ï¼Œè®¡ç®— uv ç­‰ã€‚aid åªæœ‰ç”¨æˆ·æ¸…ç†æµè§ˆå™¨ç¼“å­˜æ‰ä¼šæ›´æ–°ã€‚


å¯¹äºä¸€äº›é¡¹ç›®ï¼Œä½¿ç”¨è‡ªå·±æ„é€ çš„ aid ä½œä¸ºä¸ŠæŠ¥è§„åˆ™ï¼Œåç«¯å¯¹ aid çš„æ ¡éªŒè§„åˆ™å¦‚ä¸‹ï¼š`/^[@=.0-9a-zA-Z_-]{4,36}$/`

## å®ä¾‹æ–¹æ³•

Aegis å®ä¾‹æš´éœ²æ¥å£ç®€å•å®ç”¨ï¼Œç›®å‰ Aegis å®ä¾‹æœ‰ä»¥ä¸‹æ–¹æ³•ä¾›æ‚¨ä½¿ç”¨ï¼š  
`setConfig` ã€ `info` ã€ `infoAll` ã€ `report` ã€ `error` ã€ `reportEvent` ã€ `reportTime` ã€ `time` ã€ `timeEnd`ã€ `destroy`

### setConfig

è¯¥æ–¹æ³•ç”¨æ¥ä¿®æ”¹å®ä¾‹é…ç½®ï¼Œæ¯”å¦‚ä¸‹é¢åœºæ™¯ï¼š  
åœ¨å®ä¾‹åŒ– Aegis æ—¶éœ€è¦ä¼ å…¥é…ç½®å¯¹è±¡

```javascript
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx',
  uin: '777'
})
```

å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¹¶ä¸èƒ½ä¸€å¼€å§‹å°±è·å–åˆ°ç”¨æˆ·çš„ `uin`ï¼Œè€Œç­‰è·å–åˆ°ç”¨æˆ·çš„ `uin` æ‰å¼€å§‹å®ä¾‹åŒ– Aegis å°±æ™šäº†ï¼Œè¿™æœŸé—´å‘ç”Ÿçš„é”™è¯¯ Aegis å°†ç›‘å¬ä¸åˆ°ã€‚`uin` çš„è®¾ç½®å¯ä»¥åœ¨è·å–åˆ°ç”¨æˆ·çš„æ—¶å€™ï¼š

```javascript
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx'
})

// æ‹¿åˆ°uinä¹‹å...
aegis.setConfig({
  uin: '6666'
})
```

### infoã€infoAllã€reportã€error

è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯ Aegis æä¾›çš„ä¸»è¦ä¸ŠæŠ¥æ‰‹æ®µã€‚

```javascript
aegis.info('ä¸ŠæŠ¥ä¸€æ¡ç™½åå•æ—¥å¿—ï¼Œè¿™ä¸¤ç§æƒ…å†µè¿™æ¡æ—¥å¿—æ‰ä¼šæŠ¥åˆ°åå°ï¼š1ã€æ‰“å¼€é¡µé¢çš„ç”¨æˆ·åœ¨åå•ä¸­ï¼›2ã€å¯¹åº”çš„é¡µé¢å‘ç”Ÿäº†é”™è¯¯ğŸ¤¨');

aegis.infoAll('ä¸ŠæŠ¥äº†ä¸€æ¡æ—¥å¿—ï¼Œè¯¥ä¸ŠæŠ¥ä¸infoå”¯ä¸€çš„ä¸åŒå°±åœ¨äºï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä¸ŠæŠ¥');

aegis.error(new Error('ä¸»åŠ¨ä¸ŠæŠ¥ä¸€ä¸ªé”™è¯¯'));

// report é»˜è®¤æ˜¯ aegis.report çš„æ—¥å¿—ç±»å‹ï¼Œä½†æ˜¯ç°åœ¨ä½ å¯ä»¥ä¼ å…¥ä»»ä½•æ—¥å¿—ç±»å‹äº†
aegis.report({ 
 msg: 'è¿™æ˜¯ä¸€ä¸ªajaxé”™è¯¯æ—¥å¿—', 
 level: Aegis.logType.AJAX_ERROR, 
 ext1: 'ext1', 
 ext2: 'ext2', 
 ext3: 'ext3', 
 trace: 'trace',
});
```

info vs infoAll

1. ä½¿ç”¨ â€œinfoAll â€ æ‰€æœ‰ç”¨æˆ·éƒ½ä¸ŠæŠ¥ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„ä¸ŠæŠ¥å’Œå­˜å‚¨æˆæœ¬ã€‚
2. ä½¿ç”¨ â€œinfoâ€ ç™½åå•ä¸ŠæŠ¥ã€‚å‡ºäº†é—®é¢˜ï¼Œå¯èƒ½ä¼šç¼ºå°‘å…³é”®è·¯å¾„æ—¥å¿—ã€‚éœ€è¦æ·»åŠ ç™½åå•ï¼Œé‡æ–°æ“ä½œæ”¶é›†æ—¥å¿—ï¼ˆç±»ä¼¼äºæŸ“è‰²ç³»ç»Ÿæ“ä½œï¼‰ã€‚

### reportEvent

è¯¥æ–¹æ³•å¯ç”¨æ¥ä¸ŠæŠ¥è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹³å°å°†ä¼šè‡ªåŠ¨ç»Ÿè®¡ä¸ŠæŠ¥äº‹ä»¶çš„å„é¡¹æŒ‡æ ‡ï¼Œè¯¸å¦‚ï¼šPVã€å¹³å°åˆ†å¸ƒç­‰...

reportEvent å¯ä»¥æ”¯æŒä¸¤ç§ç±»å‹ä¸ŠæŠ¥å‚æ•°ç±»å‹ï¼Œä¸€ç§æ˜¯å­—ç¬¦ä¸²ç±»å‹

```javascript
aegis.reportEvent('XXXè¯·æ±‚æˆåŠŸ');
```

ä¸€ç§æ˜¯å¯¹è±¡ç±»å‹ï¼Œext1 ext2 ext3 é»˜è®¤ä½¿ç”¨ new Aegis çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼Œè‡ªå®šä¹‰äº‹ä»¶ä¸ŠæŠ¥çš„æ—¶å€™ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤å€¼ã€‚

```javascript
aegis.reportEvent({
  name: 'XXXè¯·æ±‚æˆåŠŸ', // å¿…å¡«
  ext1: 'é¢å¤–å‚æ•°1',
  ext2: 'é¢å¤–å‚æ•°2',
  ext3: 'é¢å¤–å‚æ•°3',
})
```

æ³¨æ„ï¼Œé¢å¤–å‚æ•°çš„ä¸‰ä¸ª key æ˜¯å›ºå®šçš„ï¼Œç›®å‰åªæ”¯æŒ ext1 ext2 ext3ã€‚

### reportTime

è¯¥æ–¹æ³•å¯ç”¨æ¥ä¸ŠæŠ¥è‡ªå®šä¹‰æµ‹é€Ÿï¼Œä¾‹å¦‚ï¼š

```javascript
// å‡å¦‚â€˜onloadâ€™çš„æ—¶é—´æ˜¯1s
aegis.reportTime('onload', 1000);
```

æˆ–è€…å¦‚æœéœ€è¦ä½¿ç”¨é¢å¤–å‚æ•°ï¼Œå¯ä»¥ä¼ å…¥å¯¹è±¡ç±»å‹å‚æ•°ï¼Œext1ï¼Œext2ï¼Œext3 ä¼šè¦†ç›–é»˜è®¤å€¼ï¼š

```javascript
aegis.reportTime({
    name: 'onload', // è‡ªå®šä¹‰æµ‹é€Ÿåç§°
    duration: 1000, // è‡ªå®šä¹‰æµ‹é€Ÿè€—æ—¶(0 - 60000)
    ext1: 'test1',
    ext2: 'test2',
    ext3: 'test3',
});
```

> `onload` å¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–çš„å‘½åã€‚

### timeã€timeEnd

è¯¥æ–¹æ³•åŒæ ·å¯ç”¨æ¥ä¸ŠæŠ¥è‡ªå®šä¹‰æµ‹é€Ÿï¼Œé€‚ç”¨äºä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´æ—¶é•¿çš„è®¡ç®—å¹¶ä¸ŠæŠ¥ï¼Œä¾‹å¦‚ï¼š

```javascript
aegis.time('complexOperation');
/**
 * .
 * .
 * åšäº†å¾ˆä¹…çš„å¤æ‚æ“ä½œä¹‹åã€‚ã€‚ã€‚
 * .
 * .
 */
aegis.timeEnd('complexOperation'); /** æ­¤æ—¶æ—¥å¿—å·²ç»æŠ¥ä¸Šå»äº†ğŸ˜„**/
```

> `complexOperation` åŒæ ·å¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–çš„å‘½åã€‚
> è‡ªå®šä¹‰æµ‹é€Ÿæ˜¯ç”¨æˆ·ä¸ŠæŠ¥ä»»æ„å€¼ï¼ŒæœåŠ¡ç«¯å¯¹å…¶è¿›è¡Œç»Ÿè®¡å’Œè®¡ç®—ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸èƒ½åšè„æ•°æ®å¤„ç†ï¼Œå› æ­¤å»ºè®®ç”¨æˆ·åœ¨ä¸ŠæŠ¥ç«¯è¿›è¡Œç»Ÿè®¡å€¼é™åˆ¶ï¼Œé˜²æ­¢è„æ•°æ®å¯¹æ•´ä½“äº§ç”Ÿå½±å“ã€‚
> ç›®å‰ Aegis åªæ”¯æŒ 0-60000 çš„æ•°å€¼è®¡ç®—ï¼Œå¦‚æœå¤§äºè¯¥å€¼ï¼Œå»ºè®®è¿›è¡Œåˆç†æ”¹é€ ã€‚

### destroy

è¯¥æ–¹æ³•ç”¨äºé”€æ¯ sdk å®ä¾‹ï¼Œé”€æ¯åï¼Œä¸å†è¿›è¡Œæ•°æ®ä¸ŠæŠ¥

```javascript
aegis.destroy();
```

## ç™½åå•

ç™½åå•åŠŸèƒ½æ˜¯é€‚ç”¨äºå¼€å‘è€…å¸Œæœ›å¯¹æŸäº›ç‰¹å®šçš„ç”¨æˆ·ä¸ŠæŠ¥æ›´å¤šçš„æ—¥å¿—ï¼Œä½†æ˜¯åˆä¸å¸Œæœ›å¤ªå¤šä¸ŠæŠ¥æ¥å½±å“åˆ°å…¨éƒ¨æ—¥å¿—æ•°æ®ï¼Œå¹¶ä¸”å‡å°‘ç”¨æˆ·çš„æ¥å£è¯·æ±‚æ¬¡æ•°ï¼Œå› æ­¤ TAM è®¾å®šäº†ç™½åå•çš„é€»è¾‘ã€‚

1. ç™½åå•ç”¨æˆ·ä¼šä¸ŠæŠ¥å…¨éƒ¨çš„ API è¯·æ±‚ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£è¯·æ±‚å’Œè¯·æ±‚ç»“æœã€‚
2. ç™½åå•ç”¨æˆ·å¯ä»¥ä½¿ç”¨ info æ¥å£ä¸ŠæŠ¥æ•°æ®ã€‚
3. info vs infoAllï¼šåœ¨å¼€å‘è€…å®é™…ä½“éªŒè¿‡ç¨‹ä¸­ï¼Œç™½åå•ç”¨æˆ·å¯ä»¥æ·»åŠ æ›´å¤šçš„æ—¥å¿—ï¼Œå¹¶ä¸”ä½¿ç”¨ info è¿›è¡Œä¸ŠæŠ¥ã€‚infoAll ä¼šå¯¹æ‰€æœ‰ç”¨æˆ·æ— å·®åˆ«è¿›è¡Œä¸ŠæŠ¥ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´æ—¥å¿—é‡ä¸ŠæŠ¥å·¨å¤§ã€‚
4. é€šè¿‡æ¥å£ whitelist æ¥åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç™½åå•ç”¨æˆ·ï¼Œç™½åå•ç”¨æˆ·çš„è¿”å›ç»“æœä¼šç»‘å®šåœ¨ aegis å®ä¾‹ä¸Š (aegis.isWhiteList) ç”¨æ¥ç»™å¼€å‘è€…ä½¿ç”¨ã€‚
5. ç”¨äº†å‡å°‘å¼€å‘è€…ä½¿ç”¨è´Ÿæ‹…ï¼Œç™½åå•ç”¨æˆ·æ˜¯å›¢é˜Ÿæœ‰æ•ˆï¼Œå¯ä»¥åœ¨ [åº”ç”¨ç®¡ç†-ç™½åå•ç®¡ç†](https://console.cloud.tencent.com/rum/web/group-whitelist-manage) å†…åˆ›å»ºç™½åå•ï¼Œåˆ™å›¢é˜Ÿä¸‹å…¨éƒ¨é¡¹ç›®éƒ½ç”Ÿæ•ˆã€‚

## é’©å­å‡½æ•°

### beforeRequest

è¯¥é’©å­å°†ä¼šåœ¨æ—¥å¿—ä¸ŠæŠ¥å‰æ‰§è¡Œï¼Œç”¨äºå¯¹ä¸ŠæŠ¥æ•°æ®çš„æ‹¦æˆªå’Œä¿®æ”¹ï¼Œé€šè¿‡è¿”å›ä¸åŒç±»å‹çš„å€¼ï¼š
* æ‹¦æˆªï¼šè¿”å›false
* ä¿®æ”¹ï¼šä¿®æ”¹å…¥å‚çš„å€¼å¹¶è¿”å›

```javascript
const aegis = new Aegis({
  id: "pGUVFTCZyewxxxxx",
  beforeRequest: function(data) {
    //å…¥å‚dataçš„æ•°æ®ç»“æ„ï¼š{logs: {â€¦}, logType: "log"}
    if(data.logType === 'log' && data.logs.msg.includes('otheve.beacon.qq.com')){
      // æ‹¦æˆªï¼šæ—¥å¿—ç±»å‹ä¸ºlogï¼Œä¸”å†…å®¹åŒ…å«otheve.beacon.qq.comçš„è¯·æ±‚
      return false;
    }
    if(data.logType === 'performance'){
      // ä¿®æ”¹ï¼šå°†æ€§èƒ½æ•°æ®çš„é¦–å±æ¸²æŸ“æ—¶é—´æ”¹ä¸º2s
      data.logs.firstScreenTiming = 2000;
      return data;
    }
  }
});
```

å…¶ä¸­ï¼Œ`msg` å°†ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼š  

> 1.`logs`: ä¸ŠæŠ¥çš„æ—¥å¿—å†…å®¹;  

> 2.`logType`: æ—¥å¿—ç±»å‹

logTypeç­‰äº`custom`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{name: "ç™½å±æ—¶é—´", duration: 3015.7000000178814, ext1: '', ext2: '', ext3: '', from: ''}
```

logTypeç­‰äº`event`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{name: "ios", ext1: "", ext2: "", ext3: ""}
```

logTypeç­‰äº`log`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{ level: '1', msg: 'æ¥å£è¯·æ±‚æ—¥å¿—ï¼ˆç™½åå•æ—¥å¿—ï¼‰' } // å…·ä½“levelä¿¡æ¯å‚è€ƒæ—¥å¿—ç­‰çº§
```

logTypeç­‰äº`performance`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{contentDownload: 2, dnsLookup: 0, domParse: 501, firstScreenTiming: 2315, resourceDownload: 2660, ssl: 4, tcp: 4, ttfb: 5}
```

logTypeç­‰äº`speed`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
// é™æ€èµ„æº
{connectTime: 0, domainLookup: 0, duration: 508.2, nextHopProtocol: "", isHttps: true, method: "get", status: 200, type: "static", url: "https://puui.qpic.cn/xxx", urlQuery: "max_age=1296000"}

// API
{duration: 26, isErr: 0, isHttps: true, method: "GET", nextHopProtocol: "", ret: "0", status: 200, type: "fetch", url: "https://xx.com/cgi-bin/whoami"}
```

logTypeç­‰äº`vitals`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{CLS: 3.365504747991234, FCP: 139.39999997615814, FID: -1, LCP: 127.899}
```
### modifyRequest

è¯¥é’©å­å‡½æ•°ä¼šåœ¨æ‰€æœ‰è¯·æ±‚å‘å‡ºå‰è°ƒç”¨ï¼Œå‚æ•°ä¸­ä¼šä¼ å…¥è¯·æ±‚çš„æ‰€æœ‰å†…å®¹ï¼Œå¿…é¡»è¿”å›å¾…å‘é€å†…å®¹ã€‚

```javascript
function changeURLArg(url,arg,arg_val) {
  var pattern=arg+' = ([^&]*)';
  var replaceText = arg+'='+arg_val;
  if (url.match(pattern)) {
    var tmp = '/('+ arg+'=)([^&]*)/gi';
    tmp = url.replace(eval(tmp),replaceText);
    return tmp;
  }
  return url;
}
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx',
  modifyRequest(options) {
    if (options.type === 'performance') {
      // é¡µé¢æµ‹é€Ÿï¼Œæ­¤æ—¶å¯ä»¥ä¿®æ”¹optionså†…å®¹ï¼Œå¦‚ä¿®æ”¹é¡µé¢æµ‹é€Ÿplatform
      options.url = changeURLArg(options.url, 'platform', type)
    }
    return options
  }
});
```
### afterRequest

è¯¥å‹¾å­å°†ä¼šåœ¨æ•°æ®ä¸ŠæŠ¥åè¢«æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š

```javascript
const aegis = new Aegis({
  id: "pGUVFTCZyewxxxxx",
  reportApiSpeed: true,
  reportAssetSpeed: true,
  afterRequest: function(msg) {
    // {isErr: false, result: Array(1), logType: "log", logs: Array(4)}
    console.log(msg);
  }
});
```

å…¶ä¸­ï¼Œ`msg` å°†ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼š  

> 1.`isErr`: è¯·æ±‚ä¸ŠæŠ¥æ¥å£æ˜¯å¦é”™è¯¯ï¼›  

> 2.`result`: ä¸ŠæŠ¥æ¥å£çš„è¿”å›ç»“æœï¼›  

> 3.`logs`: ä¸ŠæŠ¥çš„æ—¥å¿—å†…å®¹;

> 4.`logType`: æ—¥å¿—ç±»å‹ï¼Œæœ‰ä»¥ä¸‹å€¼speedï¼šæ¥å£å’Œé™æ€èµ„æºæµ‹é€Ÿï¼Œperformanceï¼šé¡µé¢æµ‹é€Ÿï¼Œvitalsï¼šweb vitalsï¼Œeventï¼šè‡ªå®šä¹‰äº‹ä»¶ï¼Œcustomï¼šè‡ªå®šä¹‰æµ‹é€Ÿ;

## é”™è¯¯ç›‘æ§

::: warning
Aegis çš„å®ä¾‹åœ¨åˆå§‹åŒ–ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œä»¥ä¸‹ç›‘æ§
1. JSæ‰§è¡Œé”™è¯¯
2. Promiseæ‰§è¡Œé”™è¯¯
3. èµ„æºåŠ è½½å¤±è´¥

å¼€å¯ `reportApiSpeed` å‚æ•°åï¼Œä¼šè‡ªåŠ¨ç›‘å¬ä»¥ä¸‹å¼‚å¸¸
1. Ajaxï¼ˆFetchï¼‰è¯·æ±‚å¼‚å¸¸
2. retcodeå¼‚å¸¸

å¼€å¯ `websocketHack` å‚æ•°åï¼Œä¼šè‡ªåŠ¨ç›‘å¬ websocket æ‰§è¡Œå¼‚å¸¸

æ³¨æ„ï¼æ˜¯ Aegis å®ä¾‹ä¼šè¿›è¡Œç›‘æ§ï¼Œå½“æ‚¨åªæ˜¯å¼•å…¥äº† SDK è€Œæ²¡æœ‰å°†å…¶å®ä¾‹åŒ–æ—¶ï¼ŒAegis å°†ä»€ä¹ˆéƒ½ä¸ä¼šåšã€‚
:::

### JSæ‰§è¡Œé”™è¯¯

Aegis é€šè¿‡ç›‘å¬ `window` å¯¹è±¡ä¸Šçš„ `onerror` äº‹ä»¶æ¥è·å–é¡¹ç›®ä¸­çš„æŠ¥é”™ï¼Œå¹¶ä¸”é€šè¿‡è§£æé”™è¯¯å’Œåˆ†æå †æ ˆï¼Œå°†é”™è¯¯ä¿¡æ¯è‡ªåŠ¨ä¸ŠæŠ¥åˆ°åå°æœåŠ¡ä¸­ã€‚è¯¥ä¸ŠæŠ¥çš„ä¸ŠæŠ¥ç­‰çº§ä¸º error ï¼Œæ‰€ä»¥ï¼Œå½“è‡ªåŠ¨ä¸ŠæŠ¥çš„é”™è¯¯è¾¾åˆ°é˜ˆå€¼æ—¶ï¼ŒAegis å°†ä¼šè‡ªåŠ¨å‘Šè­¦ï¼Œå¸®åŠ©æ‚¨å°½æ—©å‘ç°å¼‚å¸¸ã€‚ç”±äºä¸ŠæŠ¥ç­‰çº§ä¸º error ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥ä¹Ÿå°†å½±å“é¡¹ç›®çš„è¯„åˆ†ã€‚
> å¦‚æœé¡µé¢ä¸Šå¼•å…¥äº†è·¨åŸŸçš„JSè„šæœ¬ï¼Œéœ€è¦ç»™å¯¹åº”çš„ `script` æ ‡ç­¾æ·»åŠ  `crossorigin` å±æ€§ï¼Œå¦åˆ™ Aegis å°†æ— æ³•è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå‚è€ƒ [è¿™ç¯‡æ–‡ç« ](http://km.oa.com/group/11800/articles/show/386426)

æ³¨æ„å¦‚æœç”¨æˆ·ä½¿ç”¨çš„æ˜¯ vue æ¡†æ¶ï¼Œè¯·åŠ¡å¿…è‡ªå·±è·å–é”™è¯¯å¹¶ä¸”ä¸»åŠ¨ä¸ŠæŠ¥

```javascript
Vue.config.errorHandler = function(err, vm, info) {
  console.log(`Error: ${err.toString()}\nStack: ${err.stack}\nInfo: ${info}`);
  aegis.error(`Error: ${err.toString()}\nStack: ${err.stack}\nInfo: ${info}`);
};
```

### Promiseæ‰§è¡Œé”™è¯¯

é€šè¿‡ç›‘å¬ `unhandledrejection` äº‹ä»¶ï¼Œæ•è·åˆ°æœªè¢« `catch` çš„Promiseé”™è¯¯ï¼Œä¸ºäº†é¡µé¢çš„å¥å£®ï¼Œå»ºè®®æ‚¨ `catch` ä½æ‰€æœ‰çš„Promiseé”™è¯¯å“Ÿã€‚

### èµ„æºåŠ è½½å¤±è´¥

é¡µé¢å…ƒç´ å‘å‡ºçš„è¯·æ±‚å¦‚æœå¤±è´¥ï¼Œå°†ä¼šè¢« `window.onerror` äº‹ä»¶æ•è·åˆ°ï¼ˆæ•è·é˜¶æ®µï¼‰ï¼ŒAegis æ­£æ˜¯é€šè¿‡è¿™ä¸ªç‰¹æ€§ç›‘å¬çš„èµ„æºåŠ è½½å¤±è´¥ã€‚Aegisç›‘å¬äº†ä»¥ä¸‹èµ„æºï¼š  

1. `<link>` æ ‡ç­¾è¯·æ±‚çš„cssã€fontç­‰ï¼›
2. `<script>` æ ‡ç­¾è¯·æ±‚çš„è„šæœ¬ï¼›
3. `<audio>`ã€`<video>` æ ‡ç­¾è¯·æ±‚çš„å¤šåª’ä½“èµ„æºï¼›

### Ajaxï¼ˆFetchï¼‰è¯·æ±‚å¼‚å¸¸

å½“ç”¨æˆ·å¼€å¯ `reportApiSpeed` å‚æ•°åï¼ŒAegis å°†ä¼šæ”¹å†™ `XMLHttpRequest` å¯¹è±¡å’Œ `fetch` å¯¹è±¡ï¼Œç›‘å¬æ¯æ¬¡æ¥å£è¯·æ±‚ï¼ŒAegis è®¤ä¸ºä»¥ä¸‹æƒ…å†µæ˜¯å¼‚å¸¸æƒ…å†µï¼š

1. `http status` å¤§äºç­‰äº 400
2. è¯·æ±‚è¶…æ—¶ï¼Œabortï¼Œè·¨åŸŸï¼Œcancel
3. è¯·æ±‚ç»“æŸæ—¶ `http status` ä»ç„¶æ˜¯ 0ï¼Œé€šå¸¸å‘ç”Ÿäºè¯·æ±‚å¤±è´¥

æ³¨æ„ï¼š Aegis SDK åœ¨é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼Œä¸ä¼šä¸»åŠ¨æ”¶é›†æ¥å£è¯·æ±‚å‚æ•°å’Œè¿”å›ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦å¯¹è¿›å£ä¿¡æ¯è¿›è¡Œä¸ŠæŠ¥ï¼Œå¯ä»¥ä½¿ç”¨ api å‚æ•°é‡Œé¢çš„ apiDetail è¿›è¡Œå¼€å¯ã€‚

```javascript
new Aegis({
  id: '',
  reportApiSpeed: true,
  api: {
    apiDetail: true,
  },
});
```

### retcodeå¼‚å¸¸

å½“ç”¨æˆ·å¼€å¯ `reportApiSpeed` å‚æ•°å Aegis æ”¹å†™ `XMLHttpRequest` å¯¹è±¡å’Œ `fetch` å¯¹è±¡ï¼Œå°†è·å¾—APIè¿”å›çš„å†…å®¹ï¼Œå¹¶å°è¯•åœ¨å†…å®¹ä¸­è·å–åˆ°æœ¬æ¬¡è¯·æ±‚çš„ `retcode`ã€‚

> retcode çš„å€¼ä¼šä»ç”¨æˆ·è¿”å› response body çš„ç¬¬ä¸€å±‚ï¼ˆå¦‚æœç¬¬ä¸€å±‚å–ä¸åˆ°ï¼Œå†å–ç¬¬äºŒå±‚ï¼‰çš„ codeã€retã€retcodeã€errcode ä¸­è·å–ã€‚
> Aegis é»˜è®¤ retcode çš„å€¼ä¸º0æ˜¯æ­£å¸¸çš„ï¼Œé0éƒ½æ˜¯å¼‚å¸¸çš„ã€‚å½“ `retcode` å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œä¼šä¸ŠæŠ¥ä¸€ä¸ª retcodeå¼‚å¸¸çš„æ—¥å¿—ã€‚
> ç”¨æˆ·å¯ä»¥é€šè¿‡ api.retCodeHandler å¯¹è¿™ä¸ªå€¼å’Œæ˜¯å¦å¼‚å¸¸è¿›è¡Œä¿®æ­£ã€‚

### websocketå¼‚å¸¸

Aegis é»˜è®¤ä¸ä¼šå¯¹å…¨å±€ websocket å¯¹è±¡è¿›è¡Œé‡å†™ï¼Œé»˜è®¤ä¸ä¼šç›‘æ§ websocket ç›¸å…³é”™è¯¯ï¼Œå¦‚æœéœ€è¦æ‰“å¼€ç›¸å…³åŠŸèƒ½å¯ä»¥åœ¨åˆ›å»º Aegis å¯¹è±¡æ—¶è®¾ç½® `websocketHack: true`ã€‚
```javascript
new Aegis({
  id: '',
  websocketHack: true
});
```

## æ€§èƒ½ç›‘æ§

### é¡µé¢æµ‹é€Ÿ

> æ‰“å¼€æ–¹å¼ï¼šé»˜è®¤å¼€å¯  

Aegis å®ä¾‹é»˜è®¤ä¼šä¸ŠæŠ¥ä»¥ä¸‹æŒ‡æ ‡ï¼š  

**1. DNSæŸ¥è¯¢**ï¼šdomainLookupEnd - domainLookupStartï¼›  
**2. TCPè¿æ¥**ï¼šconnectEnd - connectStartï¼›  
**3. SSLå»ºè¿**ï¼šrequestStart - secureConnectionStartï¼›  
**4. è¯·æ±‚å“åº”**ï¼šresponseStart - requestStartï¼›  
**5. å†…å®¹ä¼ è¾“**ï¼šresponseEnd - responseStartï¼›  
**6. DOMè§£æ**ï¼šdomInteractive - domLoadingï¼›  
**7. èµ„æºåŠ è½½**ï¼šloadEventStart - domInteractiveï¼›  
**8. é¦–å±è€—æ—¶**ï¼šç›‘å¬é¡µé¢æ‰“å¼€3så†…çš„ **é¦–å±** DOM å˜åŒ–ï¼Œå¹¶è®¤ä¸º DOM å˜åŒ–æ•°é‡æœ€å¤šçš„é‚£ä¸€åˆ»ä¸ºé¦–å±æ¡†æ¶æ¸²æŸ“å®Œæˆæ—¶é—´ï¼ˆsdkåˆå§‹åŒ–åsetTimeout 3sæ”¶é›†é¦–å±å…ƒç´ ï¼Œç”±äºjsæ˜¯åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œæ”¶é›†æ—¶é—´ç‚¹å¯èƒ½å¤§äº3sï¼Œå¦‚æœç¬¬ä¸€æ¬¡3så†…æ— æ³•è·å–é¦–å±ï¼Œå°†ä¼šç»§ç»­è®¡ç®—ä¸‹ä¸€æ¬¡3så†…çš„å…ƒç´ å˜åŒ–ï¼Œä¸”åªä¼šå†è®¡ç®—ä¸€æ¬¡ï¼‰ï¼›  
**9. é¡µé¢å®ŒåŠ è½½æ—¶é—´**ï¼š ä¸ºå‰é¢7é¡¹æ•°æ®ä¹‹å’Œï¼›  

> å‰7é¡¹è®¡ç®—ææ–™ä» [PerformanceTiming](https://developer.mozilla.org/en-US/docs/Web/API/Performance/timing) è·å–ã€‚é¦–å±è€—æ—¶å¯¹åº”çš„ dom å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡æ‰“å° aegis.firstScreenInfo æŸ¥çœ‹ã€‚å¦‚æœ dom å…ƒç´ ä¸èƒ½ä»£è¡¨é¦–å±ï¼Œå¯ä»¥æ·»åŠ å±æ€§ \<div `aegis-first-screen-timing`\>\<\/div\>ï¼ŒæŠŠæŸä¸ªå…ƒç´ è¯†åˆ«ä¸ºé¦–å±å…³é”®å…ƒç´ ï¼ŒSDK è®¤ä¸ºåªè¦ç”¨æˆ·é¦–å±å‡ºç°æ­¤å…ƒç´ å°±æ˜¯é¦–å±å®Œæˆã€‚ä¹Ÿå¯ä»¥æ·»åŠ å±æ€§ \<div `aegis-ignore-first-screen-timing`\>\<\/div\>ï¼ŒæŠŠè¯¥ dom åˆ—å…¥é»‘åå•ã€‚

æ ¹æ®ä»¥ä¸Šæ•°æ®ï¼ŒTAM ä¸ºç”¨æˆ·ç»˜åˆ¶äº†é¡µé¢åŠ è½½ç€‘å¸ƒå›¾

![é¡µé¢åŠ è½½ç€‘å¸ƒå›¾](https://nowpic.gtimg.com/feeds_pic/kZXyd7Yh5phaicL6rEVF6T6WqpmEnWrABkff3anQHeGs/)

> åœ¨æœåŠ¡ç«¯ç›´å‡ºåœºæ™¯ï¼Œç€‘å¸ƒå›¾ä¼šå‡ºç°é¦–å±æ—¶é—´å¤§äºdomè§£æçš„æƒ…å†µï¼Œè¿™æ˜¯ç”±äºç§»åŠ¨ç«¯è®¾å¤‡å…¼å®¹æ€§é—®é¢˜ï¼Œæœ‰äº›è®¾å¤‡æ— æ³•è·å–åˆ°DNSæŸ¥è¯¢ã€TCPè¿æ¥ã€SSLå»ºè¿æ—¶é—´ï¼Œè¿™ä¸‰ä¸ªæŒ‡æ ‡æ±‡æ€»åçš„å¹³å‡å€¼åå°ï¼Œå¯¼è‡´é™¤äº†é¦–å±æ—¶é—´å¤–çš„å…¶ä»–æŒ‡æ ‡éƒ½å¾€å·¦åç§»ã€‚

### æ¥å£æµ‹é€Ÿ

> æ‰“å¼€æ–¹å¼ï¼šåˆå§‹åŒ–æ—¶ä¼ å…¥é…ç½® `reportApiSpeed: true`  

Aegis é€šè¿‡åŠ«æŒ `XHR` åŠ `fetch` è¿›è¡Œæ¥å£æµ‹é€Ÿï¼Œå…·ä½“ä»£ç åœ¨ [è¿™é‡Œ](https://git.code.oa.com/tam/aegis-sdk/blob/master/packages/web-sdk/src/plugins/cgi-speed.ts)

### èµ„æºæµ‹é€Ÿ

> æ‰“å¼€æ–¹å¼ï¼šåˆå§‹åŒ–æ—¶ä¼ å…¥é…ç½® `reportAssetSpeed: true`  

Aegis é€šè¿‡æµè§ˆå™¨æä¾›çš„ `PerformanceResourceTiming` è¿›è¡Œèµ„æºæµ‹é€Ÿï¼Œå…·ä½“ä»£ç åœ¨ [è¿™é‡Œ](https://git.code.oa.com/tam/aegis-sdk/blob/master/packages/web-sdk/src/plugins/asset-speed.ts)


## ç¯å¢ƒæ§åˆ¶

> aegis é»˜è®¤æŠŠæ•°æ®æ‰€åœ¨ç¯å¢ƒå½“ä½œ `production` è¿›è¡Œä¸ŠæŠ¥ï¼Œå¦‚æœæ‚¨æœ‰è‡ªåŠ©ä¿®æ”¹çš„éœ€æ±‚çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ env å‚æ•°è¿›è¡Œä¿®æ”¹ã€‚

```javascript
new Aegis({
  id: '',
  env: Aegis.environment.gray
})
```

Aegis.environment æšä¸¾å€¼å¦‚ä¸‹

```javascript
export enum Environment {
  production = 'production', // ç”Ÿäº§ç¯å¢ƒ
  gray = 'gray', // ç°åº¦ç¯å¢ƒ
  pre = 'pre', // é¢„å‘å¸ƒç¯å¢ƒ
  daily = 'daily', // æ—¥å‘å¸ƒç¯å¢ƒ
  local = 'local', // æœ¬åœ°ç¯å¢ƒ
  test = 'test', // æµ‹è¯•ç¯å¢ƒ
  others = 'others' // å…¶ä»–ç¯å¢ƒ
}
```

ä¿®æ”¹ env å‚æ•°åï¼Œaegis ä¸ŠæŠ¥çš„æ•°æ®éƒ½ä¼šå¸¦ä¸Šè¯¥å‚æ•°ï¼Œæ–¹ä¾¿å¼€å‘è€…åŒºåˆ†ä¸åŒç¯å¢ƒçš„æ•°æ®ï¼Œä½†æ˜¯åªæœ‰ production ç¯å¢ƒçš„æ•°æ®ä¼šå‚ä¸é¡¹ç›®å¾—åˆ†çš„è®¡ç®—ã€‚


## ç¦»çº¿æ—¥å¿—

Aegis SDK ä½¿ç”¨ [flog](https://git.code.oa.com/TAM/tam-flog) ç®¡ç†ç¦»çº¿æ—¥å¿—ï¼Œç”¨æˆ·åªéœ€è¦ç®€å•é…ç½®å°±å¯ä»¥ä½¿ç”¨

1. åœ¨ SDK ä¸­å¼€å¯ç¦»çº¿æ—¥å¿—å‚æ•°

```javascript
new Aegis({
  id: '', // ç”¨æˆ·åœ¨TAMå¹³å°ä¸Šç”³è¯·çš„ä¸ŠæŠ¥key
  uin: 'xxxx', // å¿…é¡»æœ‰ uin æ‰å¯ä»¥ä¸ŠæŠ¥ç¦»çº¿æ—¥å¿—ï¼Œå¦‚æœä¸€å¼€å§‹è·å–ä¸åˆ°ï¼Œåé¢å¯ä»¥é€šè¿‡ setConfig è®¾ç½®
  offlineLog: true, // å¼€å¯ç¦»çº¿æ—¥å¿—
})
```

ç¦»çº¿æ—¥å¿—å¼€å¯åï¼Œç”¨æˆ·çš„æ—¥å¿—å°±ä¼šè¢«æ”¶é›†åˆ°æµè§ˆå™¨çš„ IndexedDB ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå®æ—¶ä¸ŠæŠ¥ï¼Œéœ€è¦å¼€å‘è€…å¯¹ç”¨æˆ· uin

2. æ‰“å¼€å¼€å‘è€…å¹³å°å¯¹è¯¥ç”¨æˆ·è¿›è¡Œç›‘å¬

![ç›‘å¬ç”¨æˆ·](https://nowpic.gtimg.com/feeds_pic/PiajxSqBRaEJRHgqJawVuiaABmYJaPEE4DnLUicjRzSPHlyAnv8IpaTnw/)

3. å½“ç”¨æˆ·ä¸‹æ¬¡æ‰“å¼€é¡µé¢æˆ–è€…ä»£ç ä¸­æ‰§è¡Œ setConfig çš„æ—¶å€™ï¼Œç”¨æˆ·å°†æ—¥å¿—ä¸ŠæŠ¥åˆ° TAM æœåŠ¡ç«¯

è¿™ä¸ªæ—¶å€™ï¼Œç”¨æˆ·ä¾§ä¼šå‘ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯ `aegis.qq.com/offline/offlineAuto`ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦è¦å‘é€ç¦»çº¿æ—¥å¿—ï¼Œå¹¶ä¸”è¿”å›åŠ å¯† token
ä¸€ä¸ªæ˜¯ `aegis.qq.com/offline/offlineLog`ï¼Œç”¨æ¥ä¸ŠæŠ¥å½“å‰ç”¨æˆ· indexedDB ä¸­å­˜æ”¾çš„ç¦»çº¿æ—¥å¿—

4. æŸ¥çœ‹æ—¥å¿—

![æŸ¥çœ‹ç¦»çº¿æ—¥å¿—](https://nowpic.gtimg.com/feeds_pic/PiajxSqBRaELPvEiawiaQdBfibvib9icdqkQaovltMyHaWN9q2FH8NEPGAtw/)

<!-- ## å…¨é“¾è·¯ç›‘æ§

v1.24.2 ç‰ˆæœ¬ï¼ŒAegisè”æ‰‹å¤©æœºé˜ï¼Œæ¨å‡ºå…¨é“¾è·¯æ—¥å¿— ğŸ¤¨

### å…¨é“¾è·¯æ–¹æ¡ˆ

![æ–¹æ¡ˆå›¾](https://nowpic.gtimg.com/feeds_pic/PiajxSqBRaEJJD7H3plAeobSMM9SfibSc147y5FrgrwhhQpLcuYhBDRA/) -->

<!-- ### æ¥å…¥å·¥ä½œ

#### å‰ç«¯

æ‰“å¼€ Aegis å¤©æœºé˜æ’ä»¶ï¼ŒAegis å°†è‡ªåŠ¨åœ¨é¡µé¢å‘å‡ºè¯·æ±‚æ—¶ç”Ÿæˆ `trace_id`ã€`span_id`ï¼Œå¹¶ä»¥ä¸€å®šè§„åˆ™åŠ å·¥ï¼Œ
å¹¶å¡åˆ°è¯·æ±‚å¤´ `X-Tjg-Json-Span-Context` ä¸­ã€‚

```javascript
// åªç›‘æ§åŒæºAPI
new Aegis({
  // ...
  tjg: true, 
  // ...
})
// ç›‘æ§æ‰€æœ‰APIï¼ˆæ³¨æ„ï¼šéåŒæºæ¥å£æ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´å°†å¯¼è‡´è·¨åŸŸï¼ï¼ï¼‰
new Aegis({
  // ...
  tjg: {
    crossOrigin: true,
  }, 
  // ...
})
```

#### åç«¯

ğŸ¦¸ğŸ»â€â™‚ï¸ æ¥å…¥ [å¤©æœºé˜](http://tjg.oa.com/#/) ï¼Œä»è¯·æ±‚å¤´ `X-Tjg-Json-Span-Context` ä¸­è·å–åˆ° `trace_id`ã€`span_id`ï¼Œ
å¹¶ä½œä¸ºä¸»è°ƒè¿›è¡Œä¸ŠæŠ¥ã€‚ -->

## å…¼å®¹ie8

Aegis æä¾›äº†å…¼å®¹ `ie8` çš„ç‰ˆæœ¬å•¦ ğŸ¤ŸğŸ»ğŸ¤ŸğŸ»
> tnpm åŒ…ç‰ˆæœ¬éœ€å¤§äº `1.23.45`  
> cdn æš‚æœªæä¾›ï¼Œæ€¥éœ€è¯·è”ç³» `pumpkincai` ä¸Šæ¶

### å®‰è£…

```bash
tnpm install --save @tencent/aegis-web-sdk
```

### ä½¿ç”¨

```javascript
import Aegis from '@tencent/aegis-web-sdk/lib/aegis.ie.min.js';

function isIE() {
  // æµè§ˆå™¨åˆ¤æ–­
  // ie return false
  // éie return true
}

const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx',
  uin: 'xxxx',
  ie: isIE(), // æ‰“å¼€ieå¸ƒä¸æ’ä»¶
  reportAssetSpeed: !isIE(), // ieæš‚ä¸æ”¯æŒæµ‹é€Ÿ
  reportApiSpeed: !isIE(), // ieæš‚ä¸æ”¯æŒæµ‹é€Ÿ
  offlineLog: !isIE(), // ieä¸æ”¯æŒç¦»çº¿æ—¥å¿—
  onError: !isIE(), // å…³é—­é«˜ç‰ˆæœ¬é”™è¯¯ç›‘æ§
  pagePerformance: !isIE(), // å…³é—­é»˜è®¤æ‰“å¼€çš„é¡µé¢æµ‹é€Ÿï¼ˆieæš‚ä¸æ”¯æŒï¼‰
});
```

### TIPS

`ie8` ç‰ˆæœ¬çš„ SDK è·Ÿæ™®é€šçš„å¯¹æ¯”ï¼Œå¤šäº†éå¸¸å¤šçš„ polyfill ä»¥åŠieä¸“ç”¨æ’ä»¶ï¼Œæ‰€ä»¥ä½“ç§¯ç¨å¤§ï¼ˆgzip 24kbï¼‰ã€‚

## é…ç½®æ–‡æ¡£

| é…ç½® | æè¿° |
| -------- | -------- |
| id | å¿…é¡»ï¼Œstringï¼Œé»˜è®¤ æ— ã€‚<br>å¼€å‘è€…å¹³å°åˆ†é…çš„é¡¹ç›®ID |
| uin | å»ºè®®ï¼Œstringï¼Œé»˜è®¤å– cookie ä¸­çš„ uin å­—æ®µã€‚<br>ä¸šåŠ¡å®šä¹‰çš„å½“å‰ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨æ¥æŸ¥æ‰¾å›ºå®šç”¨æˆ·çš„æ—¥å¿—ã€‚ç™½åå•ä¸ŠæŠ¥æ—¶å°†æ ¹æ®è¯¥å­—æ®µåˆ¤å®šç”¨æˆ·æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå­—æ®µä»…æ”¯æŒ`å­—æ¯æ•°å­—@=._-`ï¼Œæ­£åˆ™è¡¨è¾¾å¼: `/^[@=.0-9a-zA-Z_-]{1,60}$/` |
| reportApiSpeed | å¯é€‰ï¼Œboolean æˆ–è€… <span id="jump">[object](#exp2)</span>ï¼Œé»˜è®¤ falseã€‚<br>æ˜¯å¦å¼€å¯æ¥å£æµ‹é€Ÿ |
| reportAssetSpeed | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚<br>æ˜¯å¦å¼€å¯é™æ€èµ„æºæµ‹é€Ÿ |
| pagePerformance | å¯é€‰ï¼Œboolean æˆ–è€… <span id="jump">[object](#exp3)</span>ï¼Œé»˜è®¤ trueã€‚<br>æ˜¯å¦å¼€å¯é¡µé¢æµ‹é€Ÿ |
| webVitals | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>æ˜¯å¦å¼€å¯ web vitals æµ‹é€Ÿ |
| onError | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>å½“å‰å®ä¾‹æ˜¯å¦éœ€è¦è¿›è¡Œé”™è¯¯ç›‘å¬ï¼Œè·å–é”™è¯¯æ—¥å¿— |
| aid | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>å½“å‰å®ä¾‹æ˜¯å¦ç”Ÿæˆaid |
| random | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 1ã€‚<br>0~1 æŠ½æ ·ç‡ |
| spa | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚ <br> å½“å‰é¡µé¢æ˜¯å¦æ˜¯å•é¡µåº”ç”¨ï¼Ÿtrueçš„è¯å°†ä¼šç›‘å¬hashchangeåŠhistory apiï¼Œåœ¨é¡µé¢è·³è½¬æ—¶è¿›è¡Œpvä¸ŠæŠ¥ |
| pageUrl | å¯é€‰ã€‚é»˜è®¤æ˜¯ location.hrefã€‚ <br> ä¿®æ”¹ä¸ŠæŠ¥æ•°æ®ä¸­é¡µé¢åœ°å€ï¼Œå¼€å‘è€…å¯ä»¥ä¸»åŠ¨å¯¹æ•°æ®è¿›è¡Œèšåˆå’Œé™ä½ç»´åº¦ï½œ
| urlHandler | å¯é€‰ï¼ŒFunctionã€‚ <br> åŠ¨æ€ä¿®æ”¹ä¸ŠæŠ¥æ•°æ®ä¸­é¡µé¢åœ°å€ fromï¼Œå¯ä»¥é…åˆ pageUrl å‚æ•°ä½¿ç”¨ï½œ
| version | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ sdk ç‰ˆæœ¬å·ã€‚<br>å½“å‰ä¸ŠæŠ¥ç‰ˆæœ¬ï¼Œå½“é¡µé¢ä½¿ç”¨äº†pwaæˆ–è€…å­˜åœ¨ç¦»çº¿åŒ…æ—¶ï¼Œå¯ç”¨æ¥åˆ¤æ–­å½“å‰çš„ä¸ŠæŠ¥æ˜¯æ¥è‡ªå“ªä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œä»…æ”¯æŒ`å­—æ¯æ•°å­—.,:_-`ï¼Œé•¿åº¦åœ¨ 60 ä½ä»¥å†… `/^[0-9a-zA-Z.,:_-]{1,60}$/` |
| reportImmediately | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>é‡‡é›†å®Œæ•°æ®åæ˜¯å¦ç«‹å³ä¸ŠæŠ¥ï¼Œé»˜è®¤ä¸ºtrue,å¦‚æœè®¾ç½®ä¸ºfalse,åˆ™åªé‡‡é›†æ•°æ®ï¼Œä¸è§¦å‘æ•°æ®ä¸ŠæŠ¥ï¼Œéœ€è¦ä¸šåŠ¡ä¸»åŠ¨è°ƒç”¨aegis.ready()æ–¹æ³•æ‰èƒ½è§¦å‘ä¸ŠæŠ¥ï¼Œè¯¥å‚æ•°ä¸€èˆ¬ç”¨äºä¸šåŠ¡æœ‰å¼‚æ­¥ä¸ŠæŠ¥è¯‰æ±‚çš„åœºæ™¯ï¼ˆä¾‹å¦‚é¢„åŠ è½½ï¼‰ã€‚ |
| delay | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 1000 msã€‚<br>ä¸ŠæŠ¥èŠ‚æµæ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´æ®µå†…çš„ä¸ŠæŠ¥å°†ä¼šåˆå¹¶åˆ°ä¸€ä¸ªä¸ŠæŠ¥è¯·æ±‚ä¸­ã€‚ |
| repeat | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 5ã€‚<br>é‡å¤ä¸ŠæŠ¥æ¬¡æ•°ï¼Œå¯¹äºåŒä¸€ä¸ªé”™è¯¯è¶…è¿‡å¤šå°‘æ¬¡ä¸ä¸ŠæŠ¥ã€‚ |
| env | å¯é€‰ï¼Œenumï¼Œé»˜è®¤ Aegis.environment.productionã€‚ <br> å½“å‰é¡¹ç›®è¿è¡Œæ‰€å¤„çš„ç¯å¢ƒã€‚ï½œ
| websocketHack | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ false <br>æ˜¯å¦å¼€å¯websocketç›‘æ§ã€‚ |
| offlineLog | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚<br>æ˜¯å¦ä½¿ç”¨ç¦»çº¿æ—¥å¿— |
| offlineLogExp | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 3ã€‚<br>ç¦»çº¿æ—¥å¿—è¿‡æœŸå¤©æ•° |
| api | å¯é€‰ï¼Œobjectï¼Œé»˜è®¤ä¸º {}ã€‚ç›¸å…³çš„é…ç½®:  <br> apiDetail : å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤falseã€‚ä¸ŠæŠ¥ api ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¯å¦ä¸ŠæŠ¥ api çš„è¯·æ±‚å‚æ•°å’Œè¿”å›å€¼; <br><br> retCodeHandler: Function(data: String, url: String, xhr: Object):{isErr: boolean, code: string}ï¼Œ è¿”å›ç ä¸ŠæŠ¥é’©å­å‡½æ•°ã€‚ ä¼šä¼ å…¥æ¥å£è¿”å›æ•°æ®,è¯·æ±‚urlå’Œxhrå¯¹è±¡; <br><br> reqParamHandler: Function(data: any, url: String) ä¸ŠæŠ¥è¯·æ±‚å‚æ•°çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å¯¹æ¥å£çš„è¯·æ±‚å‚æ•°è¿›è¡Œå¤„ç†ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿‡æ»¤ä¸ŠæŠ¥è¯·æ±‚å‚æ•°çš„ä¿¡æ¯; <br><br> resBodyHandler: Function(data: any, url: String) ä¸ŠæŠ¥ response è¿”å› body çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å¯¹æ¥å£è¿”å›å€¼çš„ response body è¿›è¡Œå¤„ç†ï¼Œåªä¸ŠæŠ¥å…³é”®ä¿¡æ¯; <br><br> reqHeaders: Array éœ€è¦ä¸ŠæŠ¥çš„ http è¯·æ±‚ request headers åˆ—è¡¨ã€‚ <br><br> resHeaders: Array éœ€è¦ä¸ŠæŠ¥çš„ http è¯·æ±‚ response headers åˆ—è¡¨ã€‚ <br><br> resourceTypeHandler: Functionï¼Œè¯·æ±‚èµ„æºç±»å‹ä¿®æ­£é’©å­å‡½æ•° ä¼šä¼ å…¥æ¥å£urlï¼Œè¿”å›å€¼ä¸ºâ€˜staticâ€™æˆ–â€˜fetchâ€™ã€‚<span id="jump">[è§ç¤ºä¾‹[1]](#exp1)</span> <br><br> reportRequest: boolean, é»˜è®¤ä¸ºfalseã€‚ å¼€å¯aegis.infoå…¨é‡ä¸ŠæŠ¥, ä¸éœ€è¦ç™½åå•é…ç½®ã€‚å¹¶ä¸ŠæŠ¥æ‰€æœ‰æ¥å£è¯·æ±‚ä¿¡æ¯ï¼ˆè¯·å¼€å¯reportApiSpeedï¼‰ |
| speedSample | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>æµ‹é€Ÿæ—¥å¿—æ˜¯å¦æŠ½æ ·ï¼ˆé™åˆ¶æ¯æ¡urlåªä¸ŠæŠ¥ä¸€æ¬¡æµ‹é€Ÿæ—¥å¿—ï¼‰ |
| hostUrl | å¯é€‰ï¼Œé»˜è®¤æ˜¯ `https://aegis.qq.com`ã€‚<br>å½±å“å…¨éƒ¨ä¸ŠæŠ¥æ•°æ®çš„ host åœ°å€ï¼Œä¸‹é¢å‡ ä¸ª url åœ°å€è®¾ç½®åä¼šè¦†ç›–å¯¹åº”çš„ä¸ŠæŠ¥åœ°å€ |
| url | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect'ã€‚<br>æ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| pvUrl | å¯é€‰ï¼Œstring, é»˜è®¤ 'https://aegis.qq.com/collect/pv' <br> pv ä¸ŠæŠ¥åœ°å€ ï½œ
| whiteListUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect/whitelist'ã€‚<br>ç™½åå•ç¡®è®¤æ¥å£ <br>å¦‚æœæƒ³è¦å…³é—­ç™½åå•æ¥å£è¯·æ±‚ï¼Œå¯ä»¥ä¼ ç©ºå­—ç¬¦ä¸²|
| offlineUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect/offline'ã€‚<br> ç¦»çº¿æ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| eventUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect/events'ã€‚<br> è‡ªå®šä¹‰äº‹ä»¶ä¸ŠæŠ¥åœ°å€ |
| speedUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed'ã€‚<br>æµ‹é€Ÿæ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| customTimeUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed/custom'ã€‚<br>è‡ªå®šä¹‰æµ‹é€Ÿä¸ŠæŠ¥åœ°å€ |
| performanceUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed/performance'ã€‚<br>é¡µé¢æ€§èƒ½æ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| webVitalsUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed/webvitals'ã€‚ <br> webvitals ä¸ŠæŠ¥åœ°å€ |
| dbConfig | å¯é€‰ï¼ŒObjectï¼Œå‚è€ƒåœ°å€ï¼šhttps://git.code.oa.com/vasdev/web_webpersistance_v2 ï¼ˆé…ç½® paramsï¼‰|
| ext1 | å¯é€‰ï¼Œstringï¼Œè‡ªå®šä¹‰ä¸ŠæŠ¥çš„é¢å¤–ç»´åº¦ï¼Œä¸ŠæŠ¥çš„æ—¶å€™å¯ä»¥è¢«è¦†ç›– |
| ext2 | å¯é€‰ï¼Œstringï¼Œè‡ªå®šä¹‰ä¸ŠæŠ¥çš„é¢å¤–ç»´åº¦ï¼Œä¸ŠæŠ¥çš„æ—¶å€™å¯ä»¥è¢«è¦†ç›– |
| ext3 | å¯é€‰ï¼Œstringï¼Œè‡ªå®šä¹‰ä¸ŠæŠ¥çš„é¢å¤–ç»´åº¦ï¼Œä¸ŠæŠ¥çš„æ—¶å€™å¯ä»¥è¢«è¦†ç›– |

### ç¤ºä¾‹

**[1] api.retCodeHandler**<span id="exp1"></span>ï¼Œå‡å¦‚åå°è¿”å›æ•°æ®ä¸º:
```json
{
  body: {
    code: 200,
    retCode: 0,
    data: {
      // xxx
    }
  }
}

```

ä¸šåŠ¡éœ€è¦ï¼šcodeä¸ä¸º200ï¼Œæˆ–è€…retCodeä¸ä¸º0ï¼Œæ­¤æ¬¡è¯·æ±‚å°±æ˜¯é”™è¯¯çš„ã€‚æ­¤æ—¶åªéœ€è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

```javascript
new Aegis({
  // xxx
  reportApiSpeed: true, // éœ€è¦å¼€ä¸¤ä¸ªï¼Œä¸ç„¶ä¸ä¼šæœ‰è¿”å›ç ä¸ŠæŠ¥
  reportAssetSpeed: true,
  api: {
    // æ³¨æ„ï¼Œæ­¤å¤„å¦‚æœç”¨åœ¨ieä½ç‰ˆæœ¬é‡Œé¢ï¼Œä¸èƒ½ç”¨retCodeHandler(){}è¿™ç§å†™æ³•ï¼Œieä¸æ”¯æŒ
    retCodeHandler: function(data, url, xhr) { 
      // æ³¨æ„è¿™é‡Œçš„ data çš„æ•°æ®ç±»å‹ï¼Œè·Ÿæ¥å£è¿”å›å€¼çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œå¤„ç†
      // fetch è¯·æ±‚çš„æ—¶å€™ï¼Œdata æ˜¯ stringï¼Œå¦‚æœéœ€è¦å¯¹è±¡éœ€è¦æ‰‹åŠ¨ parse ä¸‹
      // xhr è¯·æ±‚çš„æ—¶å€™ï¼Œdata æ˜¯ xhr.response æ‹¿åˆ°å®Œæ•´çš„åå°å“åº”
      try {
        data = JSON.parse(data)
      } catch(e) {}
      return {
        isErr: data.body.code !== 200 || data.body.retCode !== 0,
        code:  data.body.code
      }
    }
  }
})
```

**api.resourceTypeHandler**ï¼Œå‡å¦‚æ¥å£  

`http://example.com/test-api`  

è¿”å›çš„ `Content-Type` ä¸º `text/html`ï¼Œè¿™å°†å¯¼è‡´ Aegis è®¤ä¸ºè¯¥æ¥å£è¿”å›çš„æ˜¯é™æ€èµ„æºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ä¿®æ­£ï¼š

```javascript
new Aegis({
  reportApiSpeed: true, // éœ€è¦å¼€ä¸¤ä¸ªï¼Œä¸ç„¶ä¸ä¼šæœ‰è¿”å›ç ä¸ŠæŠ¥
  reportAssetSpeed: true,
  api: {
    resourceTypeHandler: function(url) {
      if (url?.indexOf('http://example.com/test-api') != -1) {
        return 'fetch';
      }
    }
  }
})
```

**[2] reportApiSpeed.urlHandler**<span id="exp2"></span>ï¼Œå‡å¦‚æ‚¨é¡µé¢ä¸­æœ‰restfulé£æ ¼çš„æ¥å£ï¼Œå¦‚ï¼š  
*www.example.com/user/1000*  
*www.example.com/user/1001*

åœ¨ä¸ŠæŠ¥æµ‹é€Ÿæ—¶éœ€è¦å°†è¿™äº›æ¥å£èšåˆï¼š

```javascript
new Aegis({
  // xxx
  reportApiSpeed: {
    urlHandler(url, payload) {
      if ((/www\.example\.com\/user\/\d*/).test(url)) {
        return 'www.example.com/user/:id';
      }
      return url;
    }
  }
  // xxx
})
```

**[3] pagePerformance.urlHandler**<span id="exp3"></span>ï¼Œå‡å¦‚æ‚¨çš„é¡µé¢urlæ˜¯restfulé£æ ¼çš„ï¼Œå¦‚ï¼š  
*www.example.com/user/1000*  
*www.example.com/user/1001*

åœ¨ä¸ŠæŠ¥é¡µé¢æµ‹é€Ÿæ—¶éœ€è¦å°†è¿™äº›é¡µé¢åœ°å€èšåˆï¼š

```javascript
new Aegis({
  // xxx
  pagePerformance: {
    urlHandler() {
      if ((/www\.example\.com\/user\/\d*/).test(window.location.href)) {
        return 'www.example.com/user/:id';
      }
    }
  }
  // xxx
})
```


**[4] pagePerformance.firstScreenInfo**<span id="exp4"></span>ï¼Œé»˜è®¤å€¼ä¸º falseï¼Œå¦‚æœéœ€è¦åœ¨å†…å­˜ä¸­ä¿ç•™ aegis.firstScreenInfo å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ”¹å€¼ä¸º true æ¥å®ç°ã€‚

```javascript
new Aegis({
  // xxx
  pagePerformance: {
    firstScreenInfoï¼š true
  }
  // xxx
})
```
