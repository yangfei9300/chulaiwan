# aegis-mp-sdk

Aegis æ˜¯è…¾è®¯äº‘ç›‘æ§å›¢é˜Ÿæä¾›çš„å‰ç«¯ç›‘æ§ SDKï¼Œæ¶µç›–äº†é”™è¯¯ç›‘æ§ï¼Œèµ„æºæµ‹é€Ÿï¼ˆimg, script, cssï¼‰ï¼Œæ¥å£æµ‹é€Ÿï¼Œé¡µé¢æ€§èƒ½ï¼ˆé¦–å±æ—¶é—´ï¼‰ã€‚æ— éœ€ä¾µå…¥ä»£ç ï¼Œåªéœ€å¼•å…¥ SDK å³å¯è‡ªåŠ¨å®Œæˆæ‰€æœ‰ç›‘æ§ä¸ŠæŠ¥ã€‚

åœ¨ä½¿ç”¨ aegis æ—¶æ— éœ€åœ¨ä¸šåŠ¡ä»£ç ä¸­æ‰“ç‚¹æˆ–è€…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œå¯ä»¥åšåˆ°ä¸ä¸šåŠ¡ä»£ç å……åˆ†è§£è€¦ã€‚aegis å°†ä¼šè‡ªåŠ¨ç›‘æ§å‰ç«¯é”™è¯¯ï¼Œåœ¨é”™è¯¯å‘ç”Ÿæ—¶ä¸ŠæŠ¥é”™è¯¯çš„å…·ä½“æƒ…å†µï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½é—®é¢˜ã€‚å½“æ‚¨å¼€å¯èµ„æºæµ‹é€Ÿæ—¶ï¼Œaegis å°†ä¼šè‡ªåŠ¨ç›‘å¬é¡µé¢èµ„æºåŠ è½½æƒ…å†µï¼ˆè€—è´¹æ—¶é•¿ã€æˆåŠŸç‡ç­‰ï¼‰ï¼Œå¹¶åœ¨ä¸å½±å“å‰ç«¯æ€§èƒ½çš„å‰æä¸‹æ”¶é›†å‰ç«¯çš„æ€§èƒ½æ•°æ®ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½æ€§èƒ½çŸ­æ¿ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

ä½¿ç”¨æœ¬ SDK éœ€è¦é…åˆä½¿ç”¨è…¾è®¯äº‘å‰ç«¯æ€§èƒ½ç›‘æ§ [RUM å¹³å°](https://console.cloud.tencent.com/rum)ã€‚

aegis-mp-sdk æ˜¯é’ˆå¯¹å¾®ä¿¡å°ç¨‹åºå’ŒQQå°ç¨‹åºå¼€å‘çš„æ•°æ®æ”¶é›†å’Œä¸ŠæŠ¥ SDKã€‚

## ä½¿ç”¨

### å®‰è£…

åœ¨é¡¹ç›®æ”¯æŒ NPM æ—¶æ¨èä½¿ç”¨ NPM å®‰è£… Aegis SDKã€‚

```bash
$ npm install --save aegis-mp-sdk
```

### åˆå§‹åŒ–

ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦æ–°å»ºä¸€ä¸ª Aegis å®ä¾‹ï¼Œä¼ å…¥ç›¸åº”çš„é…ç½®å³å¯ï¼š

```javascript
import Aegis from 'aegis-mp-sdk';

const aegis = new Aegis({
    id: "pGUVFTCZyewxxxxx", // é¡¹ç›®ä¸ŠæŠ¥ID
    uin: 'xxx', // ç”¨æˆ·å”¯ä¸€ IDï¼ˆå¯é€‰ï¼‰
    reportApiSpeed: true, // æ¥å£æµ‹é€Ÿ
    reportAssetSpeed: true, // é™æ€èµ„æºæµ‹é€Ÿ
    spa: true, // spa é¡µé¢éœ€è¦å¼€å¯ï¼Œé¡µé¢åˆ‡æ¢çš„æ—¶å€™ä¸ŠæŠ¥pv
})
```

å¦‚æœä½¿ç”¨ ES æ¨¡å—çš„æ–¹å¼å¼•å…¥ Aegis åæŠ¥é”™ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è§£å†³


æ–¹æ³•ä¸€ï¼šåœ¨ tsconfig.json ä¸­è®¾ç½® `esModuleInterop:true`ï¼Œç„¶åå†é€šè¿‡ `import Aegis from 'aegis-mp-sdk'` å¼•å…¥

æ–¹æ³•äºŒï¼š`import * as Aegis  from 'aegis-mp-sdk'`

æ–¹æ³•ä¸‰ï¼š`const Aegis = require('aegis-mp-sdk')`


::: warning æ³¨æ„ âš ï¸
ä¸ºäº†ä¸é—æ¼æ•°æ®ï¼Œé¡»å°½æ—©è¿›è¡Œåˆå§‹åŒ–ï¼›

aegis-sdk é»˜è®¤ä½¿ç”¨ `https://aegis.qq.com` ä½œä¸ºä¸ŠæŠ¥åŸŸåï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ `https://rumt-zh.com` ä½œä¸ºä¸ŠæŠ¥åŸŸåã€‚

å°ç¨‹åºæ¥å…¥ï¼Œæ­£å¼ç¯å¢ƒéœ€è¦å°†ä¸ŠæŠ¥åŸŸåæ·»åŠ åˆ°å®‰å…¨åŸŸåä¸­ã€‚
:::

::: tip å½“æ‚¨åšäº†ä»¥ä¸Šæ¥å…¥å·¥ä½œä¹‹åï¼Œæ‚¨å·²ç»å¼€å§‹äº«å— Aegis æä¾›çš„ä»¥ä¸‹åŠŸèƒ½ï¼š
1ã€é”™è¯¯ç›‘æ§ï¼šJSæ‰§è¡Œé”™è¯¯ï¼›  
2ã€æµ‹é€Ÿï¼šæ¥å£æµ‹é€Ÿï¼›  
3ã€æ•°æ®ç»Ÿè®¡å’Œåˆ†æï¼šå¯åœ¨ [RUM å¹³å°](https://console.cloud.tencent.com/rum) ä¸ŠæŸ¥çœ‹å„ä¸ªçº¬åº¦çš„æ•°æ®åˆ†æï¼›
:::

## æ—¥å¿—

Aegis SDK ä¼šä¸»åŠ¨æ”¶é›†ç”¨æˆ·çš„ä¸€äº›æ€§èƒ½å’Œé”™è¯¯æ—¥å¿—ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°æ¥é…ç½®å“ªäº›æ—¥å¿—éœ€è¦ä¸ŠæŠ¥ï¼Œä»¥åŠä¸ŠæŠ¥çš„æ—¥å¿—å…·ä½“ä¿¡æ¯ã€‚

### æ—¥å¿—ç±»å‹

å…¨éƒ¨æ—¥å¿—ç±»å‹å¦‚ä¸‹ï¼š

```javascript
{ logType: 'custom', name: 'è‡ªå®šä¹‰æµ‹é€Ÿ' }
{ logType: 'event', name: 'è‡ªå®šä¹‰äº‹ä»¶' }
{ logType: 'log', name: 'æ—¥å¿—' }
{ logType: 'performance', name: 'é¡µé¢æµ‹é€Ÿ' }
{ logType: 'pv', name: 'é¡µé¢PV' }
{ logType: 'speed', name: 'æ¥å£å’Œé™æ€èµ„æºæµ‹é€Ÿ' }
{ logType: 'vitals', name: 'web vitals' }
```


### æ—¥å¿—ç­‰çº§

å…¨éƒ¨æ—¥å¿—ç­‰çº§å¦‚ä¸‹ï¼š

```javascript
  { level: 1, name: 'ç™½åå•æ—¥å¿—' },
  { level: 2, name: 'ä¸€èˆ¬æ—¥å¿—' },
  { level: 4, name: 'é”™è¯¯æ—¥å¿—' },
  { level: 8, name: 'Promise é”™è¯¯' },
  { level: 16, name: 'Ajax è¯·æ±‚å¼‚å¸¸' },
  { level: 32, name: 'JS åŠ è½½å¼‚å¸¸' },
  { level: 64, name: 'å›¾ç‰‡åŠ è½½å¼‚å¸¸' },
  { level: 128, name: 'css åŠ è½½å¼‚å¸¸' },
  { level: 256, name: 'console.error' },
  { level: 512, name: 'éŸ³è§†é¢‘èµ„æºå¼‚å¸¸' }
  { level: 1024, name: 'retcode å¼‚å¸¸' }
  { level: 2048, name: 'aegis report' }
  { level: 4096, name: 'PV' }
  { level: 8192, name: 'è‡ªå®šä¹‰äº‹ä»¶' }
  { level: 16384, name: 'å°ç¨‹åº é¡µé¢ä¸å­˜åœ¨' }
  { level: 32768, name: 'websocketé”™è¯¯' }
  { level: 65536, name: 'js bridgeé”™è¯¯' }
```

### æ—¥å¿—ä¸ŠæŠ¥

åˆ›å»ºå®Œ Aegis å®ä¾‹ä¹‹åï¼Œå°±å¯ä»¥å¼€å¿ƒçš„ä¸ŠæŠ¥æ—¥å¿—å•¦ ğŸ¥°ï¼Œæ—¥å¿—ä¸ŠæŠ¥åŒæ ·ç®€å•ã€‚

```javascript
// info å¯ä»¥ä¸ŠæŠ¥ä»»æ„å­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ï¼Œä½†æ˜¯åªæœ‰æ‰“å¼€é¡µé¢çš„ç”¨æˆ·åœ¨åå•ä¸­æ‰ä¼šä¸ŠæŠ¥
aegis.info('test');
aegis.info('test', 123, ['a', 'b', 'c', 1], {a: '123'});


// ä¹Ÿå¯ä»¥ä¸ŠæŠ¥ç‰¹å®šçš„å¯¹è±¡ï¼Œæ”¯æŒç”¨æˆ·ä¼ extå‚æ•°å’Œtraceå‚æ•°
// æ³¨æ„è¿™ç§ case ä¸€å®šè¦ä¼  msg å­—æ®µ
aegis.info({
 msg: 'test',
 ext1: 'ext1',
 ext2: 'ext2',
 ext3: 'ext3',
 trace: 'trace',
});

// ä¸åŒäº infoï¼ŒinfoAll è¡¨ç¤ºå…¨é‡ä¸ŠæŠ¥
aegis.infoAll({
 msg: 'test',
 ext1: 'ext1',
 ext2: 'ext2',
 ext3: 'ext3',
 trace: 'trace',
});


// error ç”¨æ¥è¡¨ç¤º JS é”™è¯¯æ—¥å¿—ï¼Œä¹Ÿæ˜¯å…¨é‡ä¸ŠæŠ¥ï¼Œä¸€èˆ¬ç”¨äºå¼€å‘è€…ä¸»åŠ¨è·å–JSå¼‚å¸¸ï¼Œç„¶åè¿›è¡Œä¸ŠæŠ¥
aegis.error({
 msg: 'test',
 ext1: 'ext1',
 ext2: 'ext2',
 ext3: 'ext3',
 trace: 'trace',
});
aegis.error(new Error('ä¸»åŠ¨ä¸ŠæŠ¥ä¸€ä¸ªé”™è¯¯'));

// report é»˜è®¤æ˜¯ aegis.report çš„æ—¥å¿—ç±»å‹ï¼Œä½†æ˜¯ç°åœ¨ä½ å¯ä»¥ä¼ å…¥ä»»ä½•æ—¥å¿—ç±»å‹äº†
aegis.report({
 msg: 'è¿™æ˜¯ä¸€ä¸ªajaxé”™è¯¯æ—¥å¿—',
 level: Aegis.LogType.AJAX_ERROR,
 ext1: 'ext1',
 ext2: 'ext2',
 ext3: 'ext3',
 trace: 'trace',
});
```

info vs infoAll

1. ä½¿ç”¨ â€œinfoAll â€ æ‰€æœ‰ç”¨æˆ·éƒ½ä¸ŠæŠ¥ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„ä¸ŠæŠ¥å’Œå­˜å‚¨æˆæœ¬ã€‚
2. ä½¿ç”¨ â€œinfoâ€ ç™½åå•ä¸ŠæŠ¥ã€‚å‡ºäº†é—®é¢˜ï¼Œå¯èƒ½ä¼šç¼ºå°‘å…³é”®è·¯å¾„æ—¥å¿—ã€‚éœ€è¦æ·»åŠ ç™½åå•ï¼Œé‡æ–°æ“ä½œæ”¶é›†æ—¥å¿—ï¼ˆç±»ä¼¼äºæŸ“è‰²ç³»ç»Ÿæ“ä½œï¼‰ã€‚

## aid

Aegis SDK ä¸ºæ¯ä¸ªç”¨æˆ·è®¾å¤‡åˆ†é…çš„å”¯ä¸€æ ‡ç¤ºï¼Œä¼šå­˜å‚¨åœ¨å°ç¨‹åºçš„ storage é‡Œé¢ï¼Œç”¨æ¥åŒºåˆ†ç”¨æˆ·ï¼Œè®¡ç®— uv ç­‰ã€‚aid åªæœ‰ç”¨æˆ·æ¸…ç†å°ç¨‹åºç¼“å­˜æ‰ä¼šæ›´æ–°ã€‚


## å®ä¾‹æ–¹æ³•

Aegis å®ä¾‹æš´éœ²æ¥å£ç®€å•å®ç”¨ï¼Œç›®å‰ Aegis å®ä¾‹æœ‰ä»¥ä¸‹æ–¹æ³•ä¾›æ‚¨ä½¿ç”¨ï¼š
`setConfig` ã€ `info` ã€ `infoAll` ã€ `report` ã€ `error` ã€ `reportEvent` ã€ `reportTime` ã€ `time` ã€ `timeEnd`ã€ `destroy`

### setConfig

è¯¥æ–¹æ³•ç”¨æ¥ä¿®æ”¹å®ä¾‹é…ç½®ï¼Œæ¯”å¦‚ä¸‹é¢åœºæ™¯ï¼š

- åœ¨å®ä¾‹åŒ– Aegis æ—¶éœ€è¦ä¼ å…¥é…ç½®å¯¹è±¡ã€‚

```javascript
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx',
  uin: 777
})
```

- å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¹¶ä¸èƒ½ä¸€å¼€å§‹å°±è·å–åˆ°ç”¨æˆ·çš„ `uin`ï¼Œè€Œç­‰è·å–åˆ°ç”¨æˆ·çš„ `uin` æ‰å¼€å§‹å®ä¾‹åŒ– Aegisï¼Œå¦‚æœè¿™æœŸé—´å‘ç”Ÿäº†é”™è¯¯ Aegis å°†ç›‘å¬ä¸åˆ°ã€‚`uin` çš„è®¾ç½®å¯ä»¥åœ¨è·å–åˆ°ç”¨æˆ·çš„æ—¶å€™ï¼š

```javascript
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx'
})

// æ‹¿åˆ°uinä¹‹å...
aegis.setConfig({
  uin: 777
})
```

### infoã€infoAllã€report

è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯ Aegis æä¾›çš„ä¸»è¦ä¸ŠæŠ¥æ‰‹æ®µã€‚

```javascript
aegis.info('ä¸ŠæŠ¥ä¸€æ¡ç™½åå•æ—¥å¿—ï¼Œè¿™ä¸¤ç§æƒ…å†µè¿™æ¡æ—¥å¿—æ‰ä¼šæŠ¥åˆ°åå°ï¼š1ã€æ‰“å¼€é¡µé¢çš„ç”¨æˆ·åœ¨åå•ä¸­ï¼›2ã€å¯¹åº”çš„é¡µé¢å‘ç”Ÿäº†é”™è¯¯ğŸ¤¨');

aegis.infoAll('ä¸ŠæŠ¥äº†ä¸€æ¡æ—¥å¿—ï¼Œè¯¥ä¸ŠæŠ¥ä¸infoå”¯ä¸€çš„ä¸åŒå°±åœ¨äºï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä¸ŠæŠ¥');

aegis.report(new Error('ä¸ŠæŠ¥ä¸€ä¸ªé”™è¯¯'));
```

### reportEvent

è¯¥æ–¹æ³•å¯ç”¨æ¥ä¸ŠæŠ¥è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹³å°å°†ä¼šè‡ªåŠ¨ç»Ÿè®¡ä¸ŠæŠ¥äº‹ä»¶çš„å„é¡¹æŒ‡æ ‡ï¼Œè¯¸å¦‚ï¼šPVã€UVã€å¹³å°åˆ†å¸ƒç­‰...

reportEvent å¯ä»¥æ”¯æŒä¸¤ç§ç±»å‹ä¸ŠæŠ¥å‚æ•°ç±»å‹ã€‚

1. å­—ç¬¦ä¸²ç±»å‹

```javascript
aegis.reportEvent('XXXè¯·æ±‚æˆåŠŸ');
```

2. å¯¹è±¡ç±»å‹ï¼Œext1 ext2 ext3 é»˜è®¤ä½¿ç”¨ new Aegis çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼Œè‡ªå®šä¹‰äº‹ä»¶ä¸ŠæŠ¥çš„æ—¶å€™ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤å€¼ã€‚

```javascript
aegis.reportEvent({
  name: 'XXXè¯·æ±‚æˆåŠŸ',
  ext1: 'é¢å¤–å‚æ•°1',
  ext2: 'é¢å¤–å‚æ•°2',
  ext3: 'é¢å¤–å‚æ•°3',
})
```

::: warning æ³¨æ„
é¢å¤–å‚æ•°çš„ä¸‰ä¸ª key æ˜¯å›ºå®šçš„ï¼Œç›®å‰åªæ”¯æŒ `ext1`ã€ `ext2`ã€ `ext3`ã€‚
:::

### reportTime

è¯¥æ–¹æ³•å¯ç”¨æ¥ä¸ŠæŠ¥è‡ªå®šä¹‰æµ‹é€Ÿï¼Œä¾‹å¦‚ï¼š

```javascript
// å‡å¦‚â€˜onloadâ€™çš„æ—¶é—´æ˜¯1s
aegis.reportTime('onload', 1000);
```

æˆ–è€…å¦‚æœéœ€è¦ä½¿ç”¨é¢å¤–å‚æ•°ï¼Œå¯ä»¥ä¼ å…¥å¯¹è±¡ç±»å‹å‚æ•°ï¼Œext1ï¼Œext2ï¼Œext3 ä¼šè¦†ç›–é»˜è®¤å€¼ï¼š

```javascript
aegis.reportTime({
  name: 'onload', // è‡ªå®šä¹‰æµ‹é€Ÿ name
  duration: 1000, // è‡ªå®šä¹‰æµ‹é€Ÿè€—æ—¶(0 - 60000)
  ext1: 'test1',
  ext2: 'test2',
  ext3: 'test3',
});
```

> `onload` å¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–çš„å‘½åã€‚


### timeã€timeEnd

è¯¥æ–¹æ³•åŒæ ·å¯ç”¨æ¥ä¸ŠæŠ¥è‡ªå®šä¹‰æµ‹é€Ÿï¼Œé€‚ç”¨äºä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´æ—¶é•¿çš„è®¡ç®—å¹¶ä¸ŠæŠ¥ï¼Œä¾‹å¦‚ï¼š

```javascript
aegis.time('complexOperation');
/**
 * .
 * .
 * åšäº†å¾ˆä¹…çš„å¤æ‚æ“ä½œä¹‹åã€‚ã€‚ã€‚
 * .
 * .
 */
aegis.timeEnd('complexOperation'); /** æ­¤æ—¶æ—¥å¿—å·²ç»æŠ¥ä¸Šå»äº†ğŸ˜„**/
```

> `complexOperation` åŒæ ·å¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–çš„å‘½åã€‚
> è‡ªå®šä¹‰æµ‹é€Ÿæ˜¯ç”¨æˆ·ä¸ŠæŠ¥ä»»æ„å€¼ï¼ŒæœåŠ¡ç«¯å¯¹å…¶è¿›è¡Œç»Ÿè®¡å’Œè®¡ç®—ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸èƒ½åšè„æ•°æ®å¤„ç†ï¼Œå› æ­¤å»ºè®®ç”¨æˆ·åœ¨ä¸ŠæŠ¥ç«¯è¿›è¡Œç»Ÿè®¡å€¼é™åˆ¶ï¼Œé˜²æ­¢è„æ•°æ®å¯¹æ•´ä½“äº§ç”Ÿå½±å“ã€‚
> ç›®å‰ Aegis åªæ”¯æŒ 0-60000 çš„æ•°å€¼è®¡ç®—ï¼Œå¦‚æœå¤§äºè¯¥å€¼ï¼Œå»ºè®®è¿›è¡Œåˆç†æ”¹é€ ã€‚


### destroy

è¯¥æ–¹æ³•ç”¨äºé”€æ¯ sdk å®ä¾‹ï¼Œé”€æ¯åï¼Œä¸å†è¿›è¡Œæ•°æ®ä¸ŠæŠ¥

```javascript
aegis.destroy();
```

## ç™½åå•

ç™½åå•åŠŸèƒ½æ˜¯é€‚ç”¨äºå¼€å‘è€…å¸Œæœ›å¯¹æŸäº›ç‰¹å®šçš„ç”¨æˆ·ä¸ŠæŠ¥æ›´å¤šçš„æ—¥å¿—ï¼Œä½†æ˜¯åˆä¸å¸Œæœ›å¤ªå¤šä¸ŠæŠ¥æ¥å½±å“åˆ°å…¨éƒ¨æ—¥å¿—æ•°æ®ï¼Œå¹¶ä¸”å‡å°‘ç”¨æˆ·çš„æ¥å£è¯·æ±‚æ¬¡æ•°ï¼Œå› ä¸º TAM è®¾å®šäº†ç™½åå•çš„é€»è¾‘ã€‚

1. ç™½åå•ç”¨æˆ·ä¼šä¸ŠæŠ¥å…¨éƒ¨çš„ API è¯·æ±‚ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£è¯·æ±‚å’Œè¯·æ±‚ç»“æœã€‚
2. ç™½åå•ç”¨æˆ·å¯ä»¥ä½¿ç”¨ info æ¥å£ä¿¡æ¯æ•°æ®ä¸ŠæŠ¥ã€‚
3. info vs infoAllï¼šåœ¨å¼€å‘è€…å®é™…ä½“éªŒè¿‡ç¨‹ä¸­ï¼Œç™½åå•ç”¨æˆ·å¯ä»¥æ·»åŠ æ›´å¤šçš„æ—¥å¿—ï¼Œå¹¶ä¸”ä½¿ç”¨ info è¿›è¡Œä¸ŠæŠ¥ã€‚infoAll ä¼šå¯¹æ‰€æœ‰ç”¨æˆ·æ— å·®åˆ«è¿›è¡Œä¸ŠæŠ¥ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´æ—¥å¿—é‡ä¸ŠæŠ¥å·¨å¤§ã€‚
4. é€šè¿‡æ¥å£ whitelist æ¥åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç™½åå•ç”¨æˆ·ï¼Œç™½åå•ç”¨æˆ·çš„è¿”å›ç»“æœä¼šç»‘å®šåœ¨ aegis å®ä¾‹ä¸Š (aegis.isWhiteList) ç”¨æ¥ç»™å¼€å‘è€…ä½¿ç”¨ã€‚
5. ç”¨äº†å‡å°‘å¼€å‘è€…ä½¿ç”¨è´Ÿæ‹…ï¼Œç™½åå•ç”¨æˆ·æ˜¯å›¢é˜Ÿæœ‰æ•ˆï¼Œå¯ä»¥åœ¨ [åº”ç”¨ç®¡ç†-ç™½åå•ç®¡ç†](https://console.cloud.tencent.com/rum/web/group-whitelist-manage) å†…åˆ›å»ºç™½åå•ï¼Œåˆ™å›¢é˜Ÿä¸‹å…¨éƒ¨é¡¹ç›®éƒ½ç”Ÿæ•ˆã€‚


## é’©å­å‡½æ•°

### beforeRequest

è¯¥é’©å­å°†ä¼šåœ¨æ—¥å¿—ä¸ŠæŠ¥å‰æ‰§è¡Œï¼Œç”¨äºå¯¹ä¸ŠæŠ¥æ•°æ®çš„æ‹¦æˆªå’Œä¿®æ”¹ï¼Œé€šè¿‡è¿”å›ä¸åŒç±»å‹çš„å€¼ï¼š
* æ‹¦æˆªï¼šè¿”å›false
* ä¿®æ”¹ï¼šä¿®æ”¹å…¥å‚çš„å€¼å¹¶è¿”å›

```javascript
const aegis = new Aegis({
  id: "pGUVFTCZyewxxxxx",
  beforeRequest: function(data) {
    //å…¥å‚dataçš„æ•°æ®ç»“æ„ï¼š{logs: {â€¦}, logType: "log"}
    if(data.logType === 'log' && data.logs.msg.includes('otheve.beacon.qq.com')){
      // æ‹¦æˆªï¼šæ—¥å¿—ç±»å‹ä¸ºlogï¼Œä¸”å†…å®¹åŒ…å«otheve.beacon.qq.comçš„è¯·æ±‚
      return false;
    }
    if(data.logType === 'performance'){
      // ä¿®æ”¹ï¼šå°†æ€§èƒ½æ•°æ®çš„é¦–å±æ¸²æŸ“æ—¶é—´æ”¹ä¸º2s
      data.logs.firstScreenTiming = 2000;
      return data;
    }
  }
});
```

å…¶ä¸­ï¼Œ`msg` å°†ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼š  

> 1.`logs`: ä¸ŠæŠ¥çš„æ—¥å¿—å†…å®¹;  

> 2.`logType`: æ—¥å¿—ç±»å‹

logTypeç­‰äº`custom`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{name: "ç™½å±æ—¶é—´", duration: 3015.7000000178814, ext1: '', ext2: '', ext3: '', from: ''}
```

logTypeç­‰äº`event`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{name: "ios", ext1: "", ext2: "", ext3: ""}
```

logTypeç­‰äº`log`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{ level: '1', msg: 'æ¥å£è¯·æ±‚æ—¥å¿—ï¼ˆç™½åå•æ—¥å¿—ï¼‰' } // å…·ä½“levelä¿¡æ¯å‚è€ƒæ—¥å¿—ç­‰çº§
```

logTypeç­‰äº`performance`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{contentDownload: 2, dnsLookup: 0, domParse: 501, firstScreenTiming: 2315, resourceDownload: 2660, ssl: 4, tcp: 4, ttfb: 5}
```

logTypeç­‰äº`speed`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
// é™æ€èµ„æº
{connectTime: 0, domainLookup: 0, duration: 508.2, nextHopProtocol: "", isHttps: true, method: "get", status: 200, type: "static", url: "https://puui.qpic.cn/xxx", urlQuery: "max_age=1296000"}

// API
{duration: 26, isErr: 0, isHttps: true, method: "GET", nextHopProtocol: "", ret: "0", status: 200, type: "fetch", url: "https://xx.com/cgi-bin/whoami"}
```

logTypeç­‰äº`vitals`æ—¶ï¼Œlogsçš„å€¼å¦‚ä¸‹ï¼š

```sh
{CLS: 3.365504747991234, FCP: 139.39999997615814, FID: -1, LCP: 127.899}
```
### modifyRequest

è¯¥é’©å­å‡½æ•°ä¼šåœ¨æ‰€æœ‰è¯·æ±‚å‘å‡ºå‰è°ƒç”¨ï¼Œå‚æ•°ä¸­ä¼šä¼ å…¥è¯·æ±‚çš„æ‰€æœ‰å†…å®¹ï¼Œå¿…é¡»è¿”å›å¾…å‘é€å†…å®¹ã€‚

```javascript
function changeURLArg(url,arg,arg_val) {
  var pattern=arg+' = ([^&]*)';
  var replaceText = arg+'='+arg_val;
  if (url.match(pattern)) {
    var tmp = '/('+ arg+'=)([^&]*)/gi';
    tmp = url.replace(eval(tmp),replaceText);
    return tmp;
  }
  return url;
}
const aegis = new Aegis({
  id: 'pGUVFTCZyewxxxxx',
  modifyRequest(options) {
    if (options.type === 'performance') {
      // é¡µé¢æµ‹é€Ÿï¼Œæ­¤æ—¶å¯ä»¥ä¿®æ”¹optionså†…å®¹ï¼Œå¦‚ä¿®æ”¹é¡µé¢æµ‹é€Ÿplatform
      options.url = changeURLArg(options.url, 'platform', type)
    }
    return options
  }
});
```
### afterRequest

è¯¥å‹¾å­å°†ä¼šåœ¨æ•°æ®ä¸ŠæŠ¥åè¢«æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š

```javascript
const aegis = new Aegis({
  id: "pGUVFTCZyewxxxxx",
  reportApiSpeed: true,
  reportAssetSpeed: true,
  afterRequest: function(msg) {
    // {isErr: false, result: Array(1), logType: "log", logs: Array(4)}
    console.log(msg);
  }
});
```

å…¶ä¸­ï¼Œ`msg` å°†ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼š  

> 1.`isErr`: è¯·æ±‚ä¸ŠæŠ¥æ¥å£æ˜¯å¦é”™è¯¯ï¼›  

> 2.`result`: ä¸ŠæŠ¥æ¥å£çš„è¿”å›ç»“æœï¼›  

> 3.`logs`: ä¸ŠæŠ¥çš„æ—¥å¿—å†…å®¹;

> 4.`logType`: æ—¥å¿—ç±»å‹ï¼Œæœ‰ä»¥ä¸‹å€¼speedï¼šæ¥å£å’Œé™æ€èµ„æºæµ‹é€Ÿï¼Œperformanceï¼šé¡µé¢æµ‹é€Ÿï¼Œvitalsï¼šweb vitalsï¼Œeventï¼šè‡ªå®šä¹‰äº‹ä»¶ï¼Œcustomï¼šè‡ªå®šä¹‰æµ‹é€Ÿ;

## é”™è¯¯ç›‘æ§

::: warning
Aegis çš„å®ä¾‹ä¼šè‡ªåŠ¨è¿›è¡Œä»¥ä¸‹ç›‘æ§ï¼Œæ³¨æ„ï¼æ˜¯ Aegis å®ä¾‹ä¼šè¿›è¡Œç›‘æ§ï¼Œå½“æ‚¨åªæ˜¯å¼•å…¥äº† SDK è€Œæ²¡æœ‰å°†å…¶å®ä¾‹åŒ–æ—¶ï¼ŒAegis å°†ä»€ä¹ˆéƒ½ä¸ä¼šåšã€‚
:::

### JSæ‰§è¡Œé”™è¯¯

Aegis é€šè¿‡ç›‘å¬ `window` å¯¹è±¡ä¸Šçš„ `onerror` äº‹ä»¶æ¥è·å–é¡¹ç›®ä¸­çš„æŠ¥é”™ï¼Œå¹¶ä¸”é€šè¿‡è§£æé”™è¯¯å’Œåˆ†æå †æ ˆï¼Œå°†é”™è¯¯ä¿¡æ¯è‡ªåŠ¨ä¸ŠæŠ¥åˆ°åå°æœåŠ¡ä¸­ã€‚è¯¥ä¸ŠæŠ¥çš„ä¸ŠæŠ¥ç­‰çº§ä¸º error ï¼Œæ‰€ä»¥ï¼Œå½“è‡ªåŠ¨ä¸ŠæŠ¥çš„é”™è¯¯è¾¾åˆ°é˜ˆå€¼æ—¶ï¼ŒAegis å°†ä¼šè‡ªåŠ¨å‘Šè­¦ï¼Œå¸®åŠ©æ‚¨å°½æ—©å‘ç°å¼‚å¸¸ã€‚ç”±äºä¸ŠæŠ¥ç­‰çº§ä¸º error ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥ä¹Ÿå°†å½±å“é¡¹ç›®çš„æ¯æ—¥è¯„åˆ†ã€‚

### request è¯·æ±‚å¼‚å¸¸

Aegis å°†ä¼šæ”¹å†™ `wx.request`(`qq.request`) å¯¹è±¡ï¼ˆè¯·æ‚¨æ”¾å¿ƒï¼ŒAegiså¾ˆä¸“ä¸šï¼‰ï¼Œç›‘å¬æ¯æ¬¡æ¥å£è¯·æ±‚ï¼Œå½“ `statusCode` ä¸å­˜åœ¨æˆ–è€…å¤§äºç­‰äº 400 æ—¶è®¤ä¸ºè¯¥è¯·æ±‚æ˜¯ä¸€ä¸ªå¤±è´¥çš„è¯·æ±‚ï¼Œäº¦æˆ–æ˜¯æ¥å£è¶…æ—¶ï¼Œabort å’Œå…¶ä»–ç±»å‹çš„å¤±è´¥ã€‚

æ³¨æ„ï¼š Aegis SDK åœ¨é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼Œä¸ä¼šä¸»åŠ¨æ”¶é›†æ¥å£è¯·æ±‚å‚æ•°å’Œè¿”å›ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦å¯¹è¿›å£ä¿¡æ¯è¿›è¡Œä¸ŠæŠ¥ï¼Œå¯ä»¥ä½¿ç”¨ api å‚æ•°é‡Œé¢çš„ apiDetail è¿›è¡Œå¼€å¯ã€‚

```javascript
new Aegis({
  id: '',
  api: {
    apiDetail: true,
  },
});
```

### retcodeå¼‚å¸¸

åŒä¸Šï¼ŒAegis åœ¨æ”¹å†™ `wx.request`(`qq.request`) å¯¹è±¡ä¹‹åï¼Œå°†è·å¾—APIè¿”å›çš„å†…å®¹ï¼Œå¹¶å°è¯•åœ¨å†…å®¹ä¸­è·å–åˆ°æœ¬æ¬¡è¯·æ±‚çš„ `retcode`ã€‚

> retcode çš„å€¼ä¼šä»ç”¨æˆ·è¿”å› response body çš„ç¬¬ä¸€å±‚ï¼ˆå¦‚æœç¬¬ä¸€å±‚å–ä¸åˆ°ï¼Œå†å–ç¬¬äºŒå±‚ï¼‰çš„ codeã€retã€retcodeã€errcode ä¸­è·å–ã€‚
> Aegis é»˜è®¤ retcode çš„å€¼ä¸º0æ˜¯æ­£å¸¸çš„ï¼Œé0éƒ½æ˜¯å¼‚å¸¸çš„ã€‚å½“ `retcode` å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œä¼šä¸ŠæŠ¥ä¸€ä¸ª retcodeå¼‚å¸¸çš„æ—¥å¿—ã€‚
> ç”¨æˆ·å¯ä»¥é€šè¿‡ api.retCodeHandler å¯¹è¿™ä¸ªå€¼å’Œæ˜¯å¦å¼‚å¸¸è¿›è¡Œä¿®æ­£ã€‚

### websocketå¼‚å¸¸
Aegisé»˜è®¤ä¸ä¼šå¯¹å…¨å±€websocketå¯¹è±¡è¿›è¡Œé‡å†™ï¼Œé»˜è®¤ä¸ä¼šç›‘æ§websocketç›¸å…³é”™è¯¯ï¼Œå¦‚æœéœ€è¦æ‰“å¼€ç›¸å…³åŠŸèƒ½å¯ä»¥åœ¨åˆ›å»ºAegiså¯¹è±¡æ—¶è®¾ç½®websocketHack: trueã€‚
```javascript
new Aegis({
  id: '',
  websocketHack: true
});
```

## æ€§èƒ½ç›‘æ§
### é¡µé¢æ€§èƒ½

> Aegis å°ç¨‹åº SDK ä¼šè‡ªåŠ¨æ”¶é›†é¡µé¢æ€§èƒ½æ•°æ®å¹¶ä¸ŠæŠ¥ã€‚åŒ…æ‹¬ï¼š
1. ç¨‹åºå¯åŠ¨æ—¶é—´
2. ä»£ç æ³¨å…¥æ—¶é—´
3. é¡µé¢é¦–æ¬¡æ¸²æŸ“æ—¶é—´
4. è·¯ç”±åˆ‡æ¢æ—¶é—´

::: warning æ³¨æ„ âš ï¸
è·å–é¡µé¢æ€§èƒ½æ•°æ®ä¾èµ–å°ç¨‹åºçš„ Performance APIï¼Œè¯·ä¿è¯åŸºç¡€åº“ç‰ˆæœ¬ `>2.11.0`ã€‚
æ‰‹Qå°ç¨‹åºç›®å‰æš‚æ—¶ä¸æ”¯æŒ Performance APIï¼Œæ‰€ä»¥ä¸ä¼šä¸ŠæŠ¥é¡µé¢æ€§èƒ½æ•°æ®ã€‚
:::


### ç»„ä»¶æ›´æ–°æ€§èƒ½(setData)

> Aegis å°ç¨‹åº SDK é»˜è®¤ä¼šè‡ªåŠ¨è·å–ç»„ä»¶çš„æ›´æ–°æ€§èƒ½æ•°æ®å¹¶ä¸ŠæŠ¥ï¼Œä¾¿äºå¯¹ç»„ä»¶é’ˆå¯¹æ€§ä¼˜åŒ–ã€‚

::: warning æ³¨æ„ âš ï¸
è·å–æ›´æ–°æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ä¾èµ–å°ç¨‹åºæ¡†æ¶æä¾›çš„API `setUpdatePerformanceListener`ï¼Œè¯·ä¿è¯åŸºç¡€åº“ç‰ˆæœ¬ `>2.12.0`ã€‚
è¯¦æƒ…å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/update-perf-stat.html)ã€‚
:::

::: warning æ³¨ï¼š
æŸäº›åº”ç”¨åœºæ™¯ä¸‹çš„å°ç¨‹åºé¡¹ç›®å¯èƒ½æ•°æ®æ›´æ–°å¾ˆé¢‘ç¹ä»è€Œå¯¼è‡´ä¸ŠæŠ¥è¯·æ±‚è¿‡å¤šï¼Œå› æ­¤ sdk é’ˆå¯¹ setData æ•°æ®ä¸ŠæŠ¥æä¾›äº†é¢å¤–çš„é…ç½®é¡¹ï¼Œå…·ä½“å¯è§ä¸‹æ–¹`é…ç½®æ–‡æ¡£`ä¸­çš„`setDataReportConfig`é…ç½®é¡¹ã€‚
:::


### æ¥å£æµ‹é€Ÿ

> æ‰“å¼€æ–¹å¼ï¼šåˆå§‹åŒ–æ—¶ä¼ å…¥é…ç½® `reportApiSpeed: true`

Aegis é€šè¿‡åŠ«æŒ `wx.request || qq.request` è¿›è¡Œæ¥å£æµ‹é€Ÿï¼Œå…·ä½“ä»£ç åœ¨ [è¿™é‡Œ](https://git.code.oa.com/tam/aegis-sdk/blob/master/packages/mp-sdk/src/plugins/cgi-speed.ts)


## é…ç½®æ–‡æ¡£
| é…ç½® | æè¿° |
| -------- | -------- |
| id | å¿…é¡»ï¼Œstringï¼Œé»˜è®¤ æ— ã€‚<br>å¼€å‘è€…å¹³å°åˆ†é…çš„é¡¹ç›®ä¸ŠæŠ¥ID |
| uin | å»ºè®®ï¼Œstring <br>ä¸šåŠ¡å®šä¹‰çš„å½“å‰ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨æ¥æŸ¥æ‰¾å›ºå®šç”¨æˆ·çš„æ—¥å¿—ã€‚ç™½åå•ä¸ŠæŠ¥æ—¶å°†æ ¹æ®è¯¥å­—æ®µåˆ¤å®šç”¨æˆ·æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå­—æ®µä»…æ”¯æŒ`å­—æ¯æ•°å­—@=._-`ï¼Œæ­£åˆ™è¡¨è¾¾å¼: `/^[@=.0-9a-zA-Z_-]{1,60}$/` |
| onError | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>å½“å‰å®ä¾‹æ˜¯å¦éœ€è¦è¿›è¡Œé”™è¯¯ç›‘å¬ï¼Œè·å–é”™è¯¯æ—¥å¿— |
| reportApiSpeed | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚<br>æ˜¯å¦å¼€å¯æ¥å£æµ‹é€Ÿ |
| reportAssetSpeed | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚<br>æ˜¯å¦å¼€å¯é™æ€èµ„æºæµ‹é€Ÿ |
| reportLoadPackageSpeed | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ trueã€‚<br>æ˜¯å¦å¼€å¯åŒ…ä¸‹è½½è€—æ—¶ä¸ŠæŠ¥ |
| pagePerformance | å¯é€‰ï¼Œboolean é»˜è®¤ trueã€‚<br>æ˜¯å¦å¼€å¯é¡µé¢æµ‹é€Ÿ |
| version | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ sdk ç‰ˆæœ¬å·ã€‚<br>å½“å‰ä¸ŠæŠ¥ç‰ˆæœ¬ï¼Œå½“é¡µé¢ä½¿ç”¨äº†pwaæˆ–è€…å­˜åœ¨ç¦»çº¿åŒ…æ—¶ï¼Œå¯ç”¨æ¥åˆ¤æ–­å½“å‰çš„ä¸ŠæŠ¥æ˜¯æ¥è‡ªå“ªä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œä»…æ”¯æŒ`å­—æ¯æ•°å­—.,:_-`ï¼Œé•¿åº¦åœ¨ 60 ä½ä»¥å†… `/^[0-9a-zA-Z.,:_-]{1,60}$/` |
| delay | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 1000 msã€‚<br>ä¸ŠæŠ¥èŠ‚æµæ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´æ®µå†…çš„ä¸ŠæŠ¥å°†ä¼šåˆå¹¶åˆ°ä¸€ä¸ªä¸ŠæŠ¥è¯·æ±‚ä¸­ã€‚ |
| repeat | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 5ã€‚<br>é‡å¤ä¸ŠæŠ¥æ¬¡æ•°ï¼Œå¯¹äºåŒä¸€ä¸ªé”™è¯¯è¶…è¿‡å¤šå°‘æ¬¡ä¸ä¸ŠæŠ¥ã€‚ |
| env | å¯é€‰ï¼Œenumï¼Œé»˜è®¤ Aegis.environment.productionã€‚ <br> å½“å‰é¡¹ç›®è¿è¡Œæ‰€å¤„çš„ç¯å¢ƒã€‚ï½œ
| spa | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚ <br> å½“å‰é¡µé¢æ˜¯å¦æ˜¯å•é¡µåº”ç”¨ï¼Ÿtrueçš„è¯å°†ä¼šç›‘å¬hashchangeåŠhistory apiï¼Œåœ¨é¡µé¢è·³è½¬æ—¶è¿›è¡Œpvä¸ŠæŠ¥ |
| pageUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤æ˜¯å°ç¨‹åº getCurrentPagesã€‚ <br> ä¿®æ”¹ä¸ŠæŠ¥æ•°æ®ä¸­é¡µé¢åœ°å€ï¼Œå¼€å‘è€…å¯ä»¥ä¸»åŠ¨å¯¹æ•°æ®è¿›è¡Œèšåˆå’Œé™ä½ç»´åº¦ï½œ
| urlHandler | å¯é€‰ï¼ŒFunctionã€‚ <br> åŠ¨æ€ä¿®æ”¹ä¸ŠæŠ¥æ•°æ®ä¸­é¡µé¢åœ°å€ fromï¼Œå¯ä»¥é…åˆ pageUrl å‚æ•°ä½¿ç”¨ï½œ
| websocketHack | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ false <br>æ˜¯å¦å¼€å¯websocketç›‘æ§ã€‚ |
| enableHttp2 | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚<br> ä¸ŠæŠ¥æ•°æ®æ˜¯å¦æ”¯æŒ HTTP2ï¼Œé»˜è®¤æ²¡æœ‰å¼€å¯ã€‚ |
| offlineLog | å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤ falseã€‚<br>æ˜¯å¦ä½¿ç”¨ç¦»çº¿æ—¥å¿— |
| offlineLogExp | å¯é€‰ï¼Œnumberï¼Œé»˜è®¤ 3ã€‚<br>ç¦»çº¿æ—¥å¿—è¿‡æœŸå¤©æ•° |
| hostUrl | å¯é€‰ï¼Œé»˜è®¤æ˜¯ `https://aegis.qq.com`ã€‚<br>å½±å“å…¨éƒ¨ä¸ŠæŠ¥æ•°æ®çš„ host åœ°å€ï¼Œä¸‹é¢å‡ ä¸ª url åœ°å€è®¾ç½®åä¼šè¦†ç›–å¯¹åº”çš„ä¸ŠæŠ¥åœ°å€ ï½œ
| url | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect'ã€‚<br>æ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| pvUrl | å¯é€‰ï¼Œstring, é»˜è®¤ 'https://aegis.qq.com/collect/pv' <br> pv ä¸ŠæŠ¥åœ°å€ ï½œ
| whiteListUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect/whitelist'ã€‚<br>ç™½åå•ç¡®è®¤æ¥å£ <br>å¦‚æœæƒ³è¦å…³é—­ç™½åå•æ¥å£è¯·æ±‚ï¼Œå¯ä»¥ä¼ ç©ºå­—ç¬¦ä¸²|
| offlineUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect/offline'ã€‚<br> ç¦»çº¿æ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| eventUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/collect/events'ã€‚<br> è‡ªå®šä¹‰äº‹ä»¶ä¸ŠæŠ¥åœ°å€ |
| speedUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed'ã€‚<br>æµ‹é€Ÿæ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| customTimeUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed/custom'ã€‚<br>è‡ªå®šä¹‰æµ‹é€Ÿä¸ŠæŠ¥åœ°å€ |
| performanceUrl | å¯é€‰ï¼Œstringï¼Œé»˜è®¤ 'https://aegis.qq.com/speed/performance'ã€‚<br>é¡µé¢æ€§èƒ½æ—¥å¿—ä¸ŠæŠ¥åœ°å€ |
| setDataReportConfig | å¯é€‰ï¼Œobjectï¼Œé»˜è®¤ä¸º{}ã€‚ç›¸å…³çš„é…ç½®: <br> disabled: å¯é€‰ï¼ŒBooleanï¼Œé»˜è®¤falseã€‚æ˜¯å¦ç¦ç”¨setDataæ•°æ®ä¸ŠæŠ¥; <br> timeThreshold: å¯é€‰ï¼ŒNumberï¼Œå•ä½ä¸ºmsï¼Œé»˜è®¤å€¼ä¸º30ã€‚ä¸ŠæŠ¥çš„è€—æ—¶é˜ˆå€¼ï¼Œè¡¨ç¤ºä»…ä¸ŠæŠ¥æ›´æ–°è€—æ—¶è¶…è¿‡è¯¥é˜ˆå€¼çš„æ•°æ®ï¼›<br> withDataPaths: å¯é€‰ï¼ŒBooleanï¼Œé»˜è®¤ä¸ºtrueã€‚æ˜¯å¦ä¸ŠæŠ¥æœ¬æ¬¡æ›´æ–°çš„å­—æ®µä¿¡æ¯ï¼›|
| api | å¯é€‰ï¼Œobjectï¼Œé»˜è®¤ä¸º {}ã€‚ç›¸å…³çš„é…ç½®:  <br> apiDetail : å¯é€‰ï¼Œbooleanï¼Œé»˜è®¤falseã€‚ä¸ŠæŠ¥ api ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¯å¦ä¸ŠæŠ¥ api çš„è¯·æ±‚å‚æ•°å’Œè¿”å›å€¼; <br><br> retCodeHandler: Function(data: String, url: String, xhr: Object):{isErr: boolean, code: string}ï¼Œ è¿”å›ç ä¸ŠæŠ¥é’©å­å‡½æ•°ã€‚ ä¼šä¼ å…¥æ¥å£è¿”å›æ•°æ®,è¯·æ±‚urlå’Œxhrå¯¹è±¡; <br><br> reqParamHandler: Function(data: any, url: String) ä¸ŠæŠ¥è¯·æ±‚å‚æ•°çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å¯¹æ¥å£çš„è¯·æ±‚å‚æ•°è¿›è¡Œå¤„ç†ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿‡æ»¤ä¸ŠæŠ¥è¯·æ±‚å‚æ•°çš„ä¿¡æ¯; <br><br> resBodyHandler: Function(data: any, url: String) ä¸ŠæŠ¥ response è¿”å› body çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å¯¹æ¥å£è¿”å›å€¼çš„ response body è¿›è¡Œå¤„ç†ï¼Œåªä¸ŠæŠ¥å…³é”®ä¿¡æ¯; <br><br> reqHeaders: Array éœ€è¦ä¸ŠæŠ¥çš„ http è¯·æ±‚ request headers åˆ—è¡¨ã€‚ <br><br> resHeaders: Array éœ€è¦ä¸ŠæŠ¥çš„ http è¯·æ±‚ response headers åˆ—è¡¨ã€‚ <br><br> resourceTypeHandler: Functionï¼Œè¯·æ±‚èµ„æºç±»å‹ä¿®æ­£é’©å­å‡½æ•° ä¼šä¼ å…¥æ¥å£urlï¼Œè¿”å›å€¼ä¸ºâ€˜staticâ€™æˆ–â€˜fetchâ€™ã€‚<span id="jump">[è§ç¤ºä¾‹[1]](#exp1)</span> <br><br> reportRequest: boolean, é»˜è®¤ä¸ºfalseã€‚ å¼€å¯aegis.infoå…¨é‡ä¸ŠæŠ¥, ä¸éœ€è¦ç™½åå•é…ç½®ã€‚å¹¶ä¸ŠæŠ¥æ‰€æœ‰æ¥å£è¯·æ±‚ä¿¡æ¯ï¼ˆè¯·å¼€å¯reportApiSpeedï¼‰ |
| ext1 | å¯é€‰ï¼Œstringï¼Œè‡ªå®šä¹‰ä¸ŠæŠ¥çš„é¢å¤–ç»´åº¦ï¼Œä¸ŠæŠ¥çš„æ—¶å€™å¯ä»¥è¢«è¦†ç›– |
| ext2 | å¯é€‰ï¼Œstringï¼Œè‡ªå®šä¹‰ä¸ŠæŠ¥çš„é¢å¤–ç»´åº¦ï¼Œä¸ŠæŠ¥çš„æ—¶å€™å¯ä»¥è¢«è¦†ç›– |
| ext3 | å¯é€‰ï¼Œstringï¼Œè‡ªå®šä¹‰ä¸ŠæŠ¥çš„é¢å¤–ç»´åº¦ï¼Œä¸ŠæŠ¥çš„æ—¶å€™å¯ä»¥è¢«è¦†ç›– |

### ç¤ºä¾‹

**[1] retCodeHandler**<span id="exp1"></span>ï¼Œå‡å¦‚åå°è¿”å›æ•°æ®ä¸º:

```json
{
  body: {
    code: 200,
    retCode: 0,
    data: {
      // xxx
    }
  }
}

```

ä¸šåŠ¡éœ€è¦ï¼šcodeä¸ä¸º200ï¼Œæˆ–è€…retCodeä¸ä¸º0ï¼Œæ­¤æ¬¡è¯·æ±‚å°±æ˜¯é”™è¯¯çš„ã€‚æ­¤æ—¶åªéœ€è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

```javascript
new Aegis({
  // xxx
  reportApiSpeed: true, // éœ€è¦å¼€å¯ï¼Œä¸ç„¶ä¸ä¼šæœ‰è¿”å›ç ä¸ŠæŠ¥
  reportAssetSpeed: true,
  api: {
    retCodeHandler(data) {
      // æ³¨æ„è¿™é‡Œçš„dataçš„æ•°æ®ç±»å‹ï¼Œè·Ÿæ¥å£è¿”å›å€¼çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œå¤„ç†
      try {
        data = JSON.parse(data)
      } catch(e) {}
      return {
        isErr: data.body.code !== 200 || data.body.retCode !== 0,
        code:  data.body.code
      }
    }
  }
})
```
